;BEGIN FRAGMENT CODE - Do not edit anything between this and the end comment
;NEXT FRAGMENT INDEX 47
Scriptname QF_CWSiege_000954E1 Extends Quest Hidden

;BEGIN ALIAS PROPERTY RespawnDefenderPhase1D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase1D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase4B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase4B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase1D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase1D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthMoveDefenderTo2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthMoveDefenderTo2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableFastTravelTrigger
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableFastTravelTrigger Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunCaravanActor01
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunCaravanActor01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunIntEnableOnly
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunIntEnableOnly Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial10
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial10 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerStartRun01
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerStartRun01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY JarlHaafingar
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_JarlHaafingar Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY HouseCarl
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_HouseCarl Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerStartRun02
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerStartRun02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase3FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase3FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunSeverioPelagia
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunSeverioPelagia Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor04
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor04 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendTrigger4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendTrigger4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunHandleNearbyActor01
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunHandleNearbyActor01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerAttack0
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerAttack0 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarker5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarker5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor13
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor13 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarker1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarker1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeHandleNearbyActor05
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeHandleNearbyActor05 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor09
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor09 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY JarlWhiterun
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_JarlWhiterun Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDefenderRikke
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDefenderRikke Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthGateLever1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthGateLever1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase4C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase4C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarker4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarker4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor05
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor05 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase5B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase5B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor02
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase5D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase5D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase4A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase4A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial10
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial10 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase2A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase2A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmHandleNearbyActor03
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmHandleNearbyActor03 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MapMarkerLocation2
;ALIAS PROPERTY TYPE LocationAlias
LocationAlias Property Alias_MapMarkerLocation2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase2FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase2FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CatapultAttacker1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CatapultAttacker1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDrawbridgeNavCollision
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDrawbridgeNavCollision Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MapMarkerLocation1
;ALIAS PROPERTY TYPE LocationAlias
LocationAlias Property Alias_MapMarkerLocation1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Hold
;ALIAS PROPERTY TYPE LocationAlias
LocationAlias Property Alias_Hold Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor12
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor12 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunHandleNearbyActor02
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunHandleNearbyActor02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeGateLever1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeGateLever1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDrawbridgeAfter
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDrawbridgeAfter Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerDefend0
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerDefend0 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MainGateInterior
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MainGateInterior Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderImperial6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderImperial6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker1General
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker1General Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Barricade3B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Barricade3B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase5FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase5FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Barricade1A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Barricade1A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY FieldCO
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_FieldCO Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons10
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons10 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderImperial1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderImperial1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackArrowVolleyParent2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackArrowVolleyParent2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderSons3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderSons3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDrawbridge
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDrawbridge Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CatapultAttacker4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CatapultAttacker4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase3A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase3A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase3D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase3D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackTrigger5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackTrigger5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase2C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase2C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase4D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase4D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RiftenHandleNearbyActor03
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RiftenHandleNearbyActor03 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY HouseCarlWhietrun
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_HouseCarlWhietrun Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendArrowVolleyParent4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendArrowVolleyParent4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Objective2A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Objective2A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Barricade3A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Barricade3A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CatapultDefender1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CatapultDefender1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackTrigger4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackTrigger4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY ThreatTriggersToggle
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_ThreatTriggersToggle Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarkerFieldCO
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarkerFieldCO Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase4C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase4C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunCompanionsTrigger01
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunCompanionsTrigger01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker10
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker10 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase3A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase3A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Objective3B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Objective3B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Jarl
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Jarl Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase1B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase1B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunSonsSoldierToDisable03
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunSonsSoldierToDisable03 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial9
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial9 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackTrigger1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackTrigger1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunHandleNearbyActor3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunHandleNearbyActor3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackArrowVolleyParent5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackArrowVolleyParent5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial9
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial9 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackTrigger2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackTrigger2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackArrowVolleyParent4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackArrowVolleyParent4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CatapultAttacker2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CatapultAttacker2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY HouseCarlHaafingar
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_HouseCarlHaafingar Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunBridgeLever1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunBridgeLever1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase1C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase1C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MainGateExterior
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MainGateExterior Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Objective1A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Objective1A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase1A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase1A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthDisableNearbyGarrisonEnableMarker1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthDisableNearbyGarrisonEnableMarker1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase5B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase5B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeDisableNearbyGarrisonEnableMarker1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeDisableNearbyGarrisonEnableMarker1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase4D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase4D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase2D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase2D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerAttack2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerAttack2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmDockGate
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmDockGate Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperialCampMapMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperialCampMapMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY enableMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_enableMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle9
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle9 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarkerFriend
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarkerFriend Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase1A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase1A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons10
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons10 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase1B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase1B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackArrowVolleyParent3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackArrowVolleyParent3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase4FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase4FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CatapultDefender3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CatapultDefender3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerDefend1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerDefend1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunSonsSoldierToDisable01
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunSonsSoldierToDisable01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerAttack3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerAttack3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DeliverSpeechMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DeliverSpeechMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendArrowVolleyParent7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendArrowVolleyParent7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle11
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle11 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmHandleNearbyActor06
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmHandleNearbyActor06 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarker3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarker3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunHandleNearbyActor1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunHandleNearbyActor1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeHandleNearbyActor01
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeHandleNearbyActor01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderImperial4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderImperial4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase2B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase2B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DeliverSpeechMarkerHouseCarl
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DeliverSpeechMarkerHouseCarl Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarker7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarker7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase1C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase1C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunCaravanActor03
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunCaravanActor03 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarker9
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarker9 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerAttack6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerAttack6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunExtEnableOnly
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunExtEnableOnly Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerDefend5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerDefend5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Objective1B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Objective1B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDrawbridgeOBJ
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDrawbridgeOBJ Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerStartRun03
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerStartRun03 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY ImpTullius
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_ImpTullius Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CampEnableMarkerImperial
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CampEnableMarkerImperial Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerAttack1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerAttack1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY BarricadeGeneric2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_BarricadeGeneric2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RiftenHandleNearbyActor04
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RiftenHandleNearbyActor04 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase2A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase2A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase2D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase2D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderImperial5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderImperial5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase3FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase3FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendArrowVolleyParent2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendArrowVolleyParent2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase4A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase4A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase5C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase5C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeCaravanMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeCaravanMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunCaravanActor02
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunCaravanActor02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunSonsSoldierToDisable02
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunSonsSoldierToDisable02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDefenseMoveTo
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDefenseMoveTo Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase3C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase3C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmGateLever2a
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmGateLever2a Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeHandleNearbyActor03
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeHandleNearbyActor03 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerAttack4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerAttack4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase5C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase5C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase2B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase2B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerDefend2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerDefend2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase4FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase4FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase2C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase2C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunBridgeLever2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunBridgeLever2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CityCenterMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CityCenterMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSonsCampMapMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSonsCampMapMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunIntDisableOnly
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunIntDisableOnly Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor10
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor10 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarker2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarker2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase4B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase4B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase5A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase5A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendArrowVolleyParent5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendArrowVolleyParent5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor11
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor11 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CatapultDefender2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CatapultDefender2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MapMarkerLocation3
;ALIAS PROPERTY TYPE LocationAlias
LocationAlias Property Alias_MapMarkerLocation3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeHandleNearbyActor04
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeHandleNearbyActor04 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase5D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase5D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY HouseCarlEastmarch
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_HouseCarlEastmarch Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderImperial5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderImperial5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor03
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor03 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons9
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons9 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderSons2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderSons2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerAttack5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerAttack5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderSons4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderSons4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunHeimskrNewHome
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunHeimskrNewHome Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Barricade2A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Barricade2A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase3B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase3B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthDisableNearbyGarrisonEnableMarker3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthDisableNearbyGarrisonEnableMarker3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Objective3A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Objective3A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SonsGalmar
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SonsGalmar Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarker6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarker6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY ImpRikke
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_ImpRikke Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderSons5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderSons5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmHandleNearbyActor05
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmHandleNearbyActor05 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY City
;ALIAS PROPERTY TYPE LocationAlias
LocationAlias Property Alias_City Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendArrowVolleyParent6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendArrowVolleyParent6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RiftenHandleNearbyActor02
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RiftenHandleNearbyActor02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY GarrisonEnableMarkerImperialExterior
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_GarrisonEnableMarkerImperialExterior Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Barricade2B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Barricade2B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender10
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender10 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmHandleNearbyActor02
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmHandleNearbyActor02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MapMarkerLocation4
;ALIAS PROPERTY TYPE LocationAlias
LocationAlias Property Alias_MapMarkerLocation4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunAttackerGalmar
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunAttackerGalmar Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender1General
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender1General Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmHandleNearbyActor04
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmHandleNearbyActor04 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RiftenMoveDefenderTo1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RiftenMoveDefenderTo1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SpeechCrowdMarker8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SpeechCrowdMarker8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY GarrisonEnableMarkerSonsExterior
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_GarrisonEnableMarkerSonsExterior Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase5A
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase5A Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase2FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase2FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackArrowVolleyParent1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackArrowVolleyParent1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackTrigger3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackTrigger3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackTrigger6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackTrigger6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDisableNearbyGarrisonEnableMarker8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDisableNearbyGarrisonEnableMarker8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendTrigger2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendTrigger2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDisableNearbyGarrisonEnableMarker7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDisableNearbyGarrisonEnableMarker7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSonsReinforceEnabler
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSonsReinforceEnabler Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RiftenDisableNearbyGarrisonEnableMarker2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RiftenDisableNearbyGarrisonEnableMarker2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY JarlEastmarch
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_JarlEastmarch Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackArrowVolleyParent7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackArrowVolleyParent7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderImperial2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderImperial2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderSons6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderSons6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackArrowVolleyParent6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackArrowVolleyParent6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase3B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase3B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Objective2B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Objective2B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SonsUlfric
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SonsUlfric Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmGateLever2b
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmGateLever2b Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunCaravanActor04
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunCaravanActor04 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RiftenMoveDefenderTo2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RiftenMoveDefenderTo2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle14
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle14 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunCompanionsTrigger02
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunCompanionsTrigger02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle12
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle12 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackArrowVolleyParent8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackArrowVolleyParent8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CampEnableMarkerSons
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CampEnableMarkerSons Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendArrowVolleyParent8
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendArrowVolleyParent8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase1FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase1FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY BarricadeGeneric1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_BarricadeGeneric1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnDefenderPhase3C
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnDefenderPhase3C Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RiftenDisableNearbyGarrisonEnableMarker1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RiftenDisableNearbyGarrisonEnableMarker1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendTrigger3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendTrigger3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunHandleNearbyActor2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunHandleNearbyActor2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase3D
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase3D Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle10
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle10 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDisableNearbyGarrisonEnableMarker4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDisableNearbyGarrisonEnableMarker4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDisableNearbyGarrisonEnableMarker3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDisableNearbyGarrisonEnableMarker3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDisableNearbyGarrisonEnableMarker1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDisableNearbyGarrisonEnableMarker1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeDisableNearbyGarrisonEnableMarker2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeDisableNearbyGarrisonEnableMarker2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker7
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthExteriorGate
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthExteriorGate Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendArrowVolleyParent1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendArrowVolleyParent1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendTrigger1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendTrigger1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CatapultDefender4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CatapultDefender4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunExtDisableOnly
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunExtDisableOnly Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeHandleNearbyActor02
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeHandleNearbyActor02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmCaravanMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmCaravanMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefendArrowVolleyParent3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefendArrowVolleyParent3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmGateLever1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmGateLever1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperialReinforceEnabler
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperialReinforceEnabler Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmHandleNearbyActor01
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmHandleNearbyActor01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor08
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor08 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunCaravanMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunCaravanMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WindhelmHandleNearbyActor07
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WindhelmHandleNearbyActor07 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerDefend4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerDefend4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerSons9
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerSons9 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthGateLever2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthGateLever2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderImperial3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderImperial3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor01
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DefenderSons4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DefenderSons4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase5FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase5FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor06
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor06 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthHandleNearbyActor07
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthHandleNearbyActor07 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY BattleCenterMarker
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_BattleCenterMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthMoveDefenderTo1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthMoveDefenderTo1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthMoveDefenderTo3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthMoveDefenderTo3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle16
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle16 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RiftenMoveDefenderTo3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RiftenMoveDefenderTo3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CatapultAttacker3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CatapultAttacker3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RiftenHandleNearbyActor01
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RiftenHandleNearbyActor01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthDisableNearbyGarrisonEnableMarker2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthDisableNearbyGarrisonEnableMarker2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerDefend6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerDefend6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MarkarthDisableNearbyGarrisonEnableMarker4
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_MarkarthDisableNearbyGarrisonEnableMarker4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle15
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle15 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker9
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker9 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackerImperial6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AttackerImperial6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Attacker2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Attacker2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY RespawnAttackerPhase1FailSafe
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_RespawnAttackerPhase1FailSafe Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDisableNearbyGarrisonEnableMarker2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDisableNearbyGarrisonEnableMarker2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SolitudeHandleNearbyActor06
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_SolitudeHandleNearbyActor06 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Defender9
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Defender9 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Barricade1B
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_Barricade1B Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDisableNearbyGarrisonEnableMarker6
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDisableNearbyGarrisonEnableMarker6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY NonRespawningDefenderSons1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_NonRespawningDefenderSons1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunDisableNearbyGarrisonEnableMarker5
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunDisableNearbyGarrisonEnableMarker5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY WhiterunSonsSoldierToDisable04
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_WhiterunSonsSoldierToDisable04 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AllyMarkerDefend3
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_AllyMarkerDefend3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DisableMapMarkerForBattle13
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_DisableMapMarkerForBattle13 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CWOTullius
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CWOTullius Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CWOUlfric
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CWOUlfric Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CWOBattleRikke
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CWOBattleRikke Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CWOBattleGalmar
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CWOBattleGalmar Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CWOAlduin
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CWOAlduin Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CWODragon1
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CWODragon1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CWODragon2
;ALIAS PROPERTY TYPE ReferenceAlias
ReferenceAlias Property Alias_CWODragon2 Auto
;END ALIAS PROPERTY

;BEGIN FRAGMENT Fragment_6
Function Fragment_6()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;Defense only - triggered by walking out of the HQ



;**CITY SPECIFIC:
kmyQuest.MUSCombatCivilWar.Add()
location cityVar = Alias_City.GetLocation()
if cityVar == kmyQuest.CWs.WhiterunLocation
	;Adds this music to stack, at highest priority
	;kmyQuest.MUSCombatCivilWar.Add()	;CWO Comment out

	;kmyQuest.WeatherWhiterun.SetActive(True)	;CWO Comment out
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	;kmyQuest.WeatherMarkarth.SetActive(True)	;CWO Comment out
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	;kmyQuest.WeatherMarkarth.SetActive(True)	;CWO Comment out
	if kmyQuest.IsAttack()
		;Nothing Special
	else
		Alias_Barricade3A.GetReference().Disable(false); Disable barricades so the player can get from city to general
		Alias_Barricade2A.GetReference().Disable(false)
	endIf
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	kmyQuest.WeatherSolitude.SetActive(true, false)
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	kmyQuest.WeatherWindhelm.SetActive(true, false)
endIf
;END CODE
endFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_34
Function Fragment_34()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;Attack only - triggered by walking out of the Tent
Alias_Attacker4.GetReference().MoveTo(Alias_AttackerStartRun01.GetReference(), 0.000000, 0.000000, 0.000000, true)
Alias_Attacker6.GetReference().MoveTo(Alias_AttackerStartRun02.GetReference(), 0.000000, 0.000000, 0.000000, true)
Alias_Attacker8.GetReference().MoveTo(Alias_AttackerStartRun03.GetReference(), 0.000000, 0.000000, 0.000000, true)
;**CITY SPECIFIC:
location cityVar = Alias_City.GetLocation()
if cityVar == kmyQuest.CWs.WhiterunLocation
	;Set Global Dialog Stuff
	;Attack has started
	kmyQuest.CWs.CWStateAttackStarted.SetValue(1 as Float)
	;Adds this music to stack, at highest priority
	kmyQuest.MUSCombatCivilWar.Add()
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	;myQuest.WeatherMarkarth.setActive(True) - CWO Comment out
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	;kmyQuest.WeatherRiften.setActive(True) - CWO Comment out
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	kmyQuest.WeatherSolitude.SetActive(true, false)
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	kmyQuest.WeatherWindhelm.SetActive(true, false)
endIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_27
Function Fragment_27()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 255 shutdown phase.")  ;*** WRITE TO LOG

;CWO Stuff	
Alias_CWOTullius.GetReference().Delete()
Alias_CWOUlfric.GetReference().Delete()
Alias_CWOBattleRikke.GetReference().Delete()
Alias_CWOBattleGalmar.GetReference().Delete()
;kmyQuest.CWOArmorDisguises.start()
;CWO Stuff

Alias_WhiterunCompanionsTrigger01.GetReference().Enable(false)
Alias_WhiterunCompanionsTrigger02.GetReference().Enable(false)

Alias_DisableFastTravelTrigger.TryToDisable()

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 255 setting CWBattlePhase to 0");*** WRITE TO LOG
if kmyQuest.CWPrepareCity.IsRunning()
	kmyQuest.CWPrepareCity.stop()
endIf
kmyQuest.CWs.CWBattlePhase.SetValue(0 as Float)
kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()

kmyQuest.CWDistantCatapultsAMB.SetValue(0 as Float)		;Disable distant catapults if weather is enabled.

;DONE ELSEWHERE, BUT JUST IN CASE:
;if this is the first Whiterun siege (we assume this because the whiterun siege because that is always the first one)
if kmyQuest.CWs.WhiterunSiegeFinished == false
	kmyQuest.CWs.WhiterunSiegeFinished = true
endIf

;Unlock the windhelm gate in case it's locked
Alias_WindhelmDockGate.GetReference().Lock(false, false)

;CLEAN UP
kmyQuest.DisableAllAliases()		;see CWSiegeScript.psc

;allow player activation of main gate into city
Alias_MainGateExterior.GetReference().BlockActivation(false)  ;normally happens in the course of the siege, but just in case.

;Disable aliases
Alias_ThreatTriggersToggle.TryToDisable()

Alias_NonRespawningDefenderImperial1.TryToDisable()
Alias_NonRespawningDefenderImperial2.TryToDisable()
Alias_NonRespawningDefenderImperial3.TryToDisable()
Alias_NonRespawningDefenderImperial4.TryToDisable()
Alias_NonRespawningDefenderImperial5.TryToDisable()
Alias_NonRespawningDefenderImperial6.TryToDisable()
Alias_NonRespawningDefenderSons1.TryToDisable()
Alias_NonRespawningDefenderSons2.TryToDisable()
Alias_NonRespawningDefenderSons3.TryToDisable()
Alias_NonRespawningDefenderSons4.TryToDisable()
Alias_NonRespawningDefenderSons5.TryToDisable()
Alias_NonRespawningDefenderSons6.TryToDisable()

;THIS ALSO HAPPENS IN STAGE 200
CWScript.Log("CWSiegeQuestFragmentScript", self + "Shutdown phase calling TryToTurnOffCatapultAlias() on Catapult aliases")	
;Turn off all the Catapults
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker4)

kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender4)

Alias_WhiterunDrawbridge.GetReference().Enable(false)

;Release Weather
weather.ReleaseOverride()

;Zero out Global State Dialog Stuff
kmyQuest.CWs.CWStateAttackStarted.SetValue(0 as Float)
kmyQuest.CWs.CWStateAttackerAtGate.SetValue(0 as Float)
kmyQuest.CWs.CWStateAttackerLowReinforcements.SetValue(0 as Float)
kmyQuest.CWs.CWStateAttackerOutOfReinforcements.SetValue(0 as Float)
kmyQuest.CWs.CWStateAttackerBrokeThrough.SetValue(0 as Float)
kmyQuest.CWs.CWStateDefenderFallingBack.SetValue(0 as Float)
kmyQuest.CWs.CWStateDefenderLastStand.SetValue(0 as Float)
kmyQuest.CWs.CWStateDefenderLowReinforcements.SetValue(0 as Float)
kmyQuest.CWs.CWStateDefenderOutOfReinforcements.SetValue(0 as Float)

CWScript.Log("CWSiegeQuestFragmentScript", self + "calling DeactivateAllies() on CWAllies quest.")  ;*** WRITE TO LOG
kmyQuest.CWs.CWAlliesS.DeactivateAllies()

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 255: UnregisterForUpdate().")
self.UnregisterForUpdate()

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 255: ToggleMapMarkersAndFastTravelEndBattle().")
kmyQuest.ToggleMapMarkersAndFastTravelEndBattle(kmyQuest.IsAttack())	;*** CHANGE THIS TO FALSE IF THIS IS A DEFENSE QUEST

CWScript.Log("CWSiegeQuestFragmentScript", self + "turning on complex WI interactions")  ;*** WRITE TO LOG
kmyQuest.ToggleOnComplexWIInteractions(Alias_City)

;Doublecheck that all reinforcements are disabled
Alias_AttackerImperialReinforceEnabler.GetReference().Disable(false)
Alias_AttackerSonsReinforceEnabler.GetReference().Disable(false)

;ALSO HAPPENS IN STAGE 200
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 255, stopping sounds and music") ;*** WRITE TO LOG
kmyQuest.StopCombatSoundsLoop()
;Removes this music from the stack
kmyQuest.MUSCombatCivilWar.Remove()

;disabled battle center marker
Alias_BattleCenterMarker.GetReference().Enable(false)

Alias_WhiterunDefenderRikke.GetReference().Disable(false)
Alias_WhiterunAttackerGalmar.GetReference().Disable(false)

Alias_WhiterunCaravanActor01.GetReference().Enable(false)
Alias_WhiterunCaravanActor02.GetReference().Enable(false)
Alias_WhiterunCaravanActor03.GetReference().Enable(false)
Alias_WhiterunCaravanActor04.GetReference().Enable(false)

;**CITY SPECIFIC
location cityVar = Alias_City.GetLocation()
;CWO Stuff
if (cityVar == kmyQuest.CWs.SolitudeLocation || cityVar == kmyQuest.CWs.WindhelmLocation) && kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValue() > 0 as Float
	
else
	kmyQuest.CWs.CWOStillABetterEndingMonitor.stop()
endIf

;USLEEP 3.0.10 Bug #14135
alias_CampEnableMarkerSons.GetReference().Disable()
Alias_CampEnableMarkerImperial.GetReference().Disable()

;CWO Stuff
if cityVar == kmyQuest.CWs.WhiterunLocation

	;PATCH 1.9 -- #73449
	;turn on random dragons if the MQ doesn't want them off
	if MQ106.getStage() >= 5 && MQ106.getStage() < 160
		;do nothing, MQ still wants them off
	else
		MQ106TurnOffRandomDragons.SetValue(0)
	endif
	
	;CWO Stuff
	if kmyQuest.CWOAttack == true
		Alias_WhiterunDrawbridge.GetReference().Disable(false)
		Alias_WhiterunDrawbridgeNavCollision.GetReference().Disable(false)
		Alias_WhiterunDrawbridgeAfter.GetReference().Enable(false)
	endIf
;		if kmyquest.IsAttack()
;			Alias_WhiterunDrawbridge.GetReference().Disable()
;			Alias_WhiterunDrawbridgeNavCollision.GetReference().Disable()
;			Alias_WhiterunDrawbridgeAfter.GetReference().Enable()
;
;		else
;			;Nothing yet
;		endif
	;CWO Stuff
	
	;if either attack or defense
	
	Alias_WhiterunBridgeLever1.GetReference().Disable(false)
	Alias_WhiterunBridgeLever2.GetReference().Disable(false)
	
	sound.StopInstance(kmyQuest.AMBDistantBattleSoundInstance)
	sound.StopInstance(kmyQuest.AMBDistantBattleStartInstance)
	sound.StopInstance(kmyQuest.AMBCloseBattleSoundInstance)
	kmyQuest.WhiterunAmbExt01.Disable(false)
	kmyQuest.WhiterunAmbExt02.Disable(false)
	kmyQuest.WhiterunAmbExt03.Disable(false)
	
	;(kmyquest.DA08 as DA08QuestScript).WhiterunSiegeHappening(FALSE) - USKP 2.0.1 - Stop access to this as it's part of the cut portions of DA08.
	
	;release reservations
	
	debug.trace("schofida -- kmyQuest.CWs.Playerallegiance -> " + kmyQuest.CWs.Playerallegiance as string)
	debug.trace("schofida -- kmyQuest.CWOFailure -> " + kmyQuest.AttackersHaveWon as string)

	if ((kmyQuest.CWs.Playerallegiance == kmyQuest.CWs.iImperials && kmyQuest.CWOFailure == 1) || (kmyQuest.CWs.Playerallegiance == kmyQuest.CWs.iSons && kmyQuest.CWOFailure == 0))
		;USKP 1.3.2 moved Heimskr's new home enabler here. He is in jail if Imperials take Whiterun.
		Alias_WhiterunHeimskrNewHome.GetReference().Enable()

		;USKP 2.0.1 - Stormcloaks have Whiterun. Enable their Watchtower guards.
		Alias_WhiterunDisableNearbyGarrisonEnableMarker6.GetReference().Enable()
		
		;USKP 2.0.4 - Stormcloaks activate in Riverwood. This has proven unreliable for some reason so do it manually.
		RiverwoodStormcloaksMarker.Enable()
		RiverwoodImperialsMarker.Disable()
		
		;schofida - Whiterun has repeating sieges
		;schofida - Heimskr released from Jail :)
		Alias_WhiterunDisableNearbyGarrisonEnableMarker5.GetReference().Disable()
		USLEEPHeimskrPreachJail.SetStage(8)
	else
		;USKP 1.3.2 moved Heimskr's new home enabler here. He is in jail if Imperials take Whiterun.
		Alias_WhiterunHeimskrNewHome.GetReference().Disable()
		;USKP 2.0.1 - Imperials have Whiterun. Enable their Watchtower guards.
		Alias_WhiterunDisableNearbyGarrisonEnableMarker5.GetReference().Enable()
		
		;schofida - Whiterun has repeating sieges
		Alias_WhiterunDisableNearbyGarrisonEnableMarker6.GetReference().Disable()
		RiverwoodStormcloaksMarker.Disable()
		RiverwoodImperialsMarker.Enable()

		;USKP 2.0.1 - Heimskr goes to Jail :(
		USLEEPHeimskrPreachJail.SetStage(3)
	EndIf
	
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	
elseIf cityVar == kmyQuest.CWs.WindhelmLocation

	;THIS PREVENTS THE MURDER SCENE DURING THE SIEGE
	kmyQuest.MS11.CivilWarBattle(false)
	
endIf

game.GetPlayer().RemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)

;under the current paradigm you won't ever be repeating a siege, but just incase:
Alias_FieldCO.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker1General.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker2.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker3.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker4.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker5.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker6.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker7.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker8.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker9.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Attacker10.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)

Alias_Defender1General.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Defender2.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Defender3.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Defender4.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Defender5.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Defender6.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Defender7.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Defender8.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Defender9.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)
Alias_Defender10.TryToRemoveFromFaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)

;Reset Dialog States
kmyQuest.CWStateAttackerAtGate.SetValue(0 as Float)
kmyQuest.CWStateAttackerBrokeThrough.SetValue(0 as Float)
kmyQuest.CWStateAttackerLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackerOutOfReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackStarted.SetValue(0 as Float)
kmyQuest.CWStateDefenderFallingBack.SetValue(0 as Float)
kmyQuest.CWStateDefenderLastStand.SetValue(0 as Float)
kmyQuest.CWStateDefenderLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateDefenderOutOfReinforcements.SetValue(0 as Float)

;USLEEP Comment out
;if (kmyQuest.AttackersHaveWon == TRUE) && (kmyQuest.DefendersHaveWon == FALSE)
;	Alias_WhiterunHeimskrNewHome.GetReference().Enable()
;endif

CWScript.Log("CWSiegeQuestFragmentScript", self + "setting CWSiegeRunning keyword data to 0")  ;*** WRITE TO LOG
Alias_City.GetLocation().setKeywordData(kmyQuest.CWs.CWSiegeRunning, 0 as Float)

;schofida - reset crime on Stormcloaks/imperials so you are not attacked by soldiers when you are back at tent
kmyQuest.CWs.CrimeFactionImperial.SetCrimeGold(0)
kmyQuest.CWs.CrimeFactionImperial.SetCrimeGoldViolent(0)
kmyQuest.CWs.CrimeFactionSons.SetCrimeGold(0)
kmyQuest.CWs.CrimeFactionSons.SetCrimeGoldViolent(0)

;CWO Stuff
;schofida - TODO: There's a lot of squirrely stuff going on here. Needs more research
debug.trace("schofida -- kmyQuest.CWOFailure -> " + kmyQuest.CWOFailure as string)
debug.trace("schofida -- kmyQuest.CWs.GetOwner(Alias_Hold.GetLocation()) -> " + kmyQuest.CWs.GetOwner(Alias_Hold.GetLocation()) as string)
debug.trace("schofida -- kmyQuest.CWs.Playerallegiance -> " + kmyQuest.CWs.Playerallegiance as string)
debug.trace("schofida -- kmyQuest.CWs.SolitudeLocation.IsSameLocation(cityVar) -> " + kmyQuest.CWs.SolitudeLocation.IsSameLocation(cityVar) as string)	
debug.trace("schofida -- kmyQuest.CWs.SolitudeLocation.IsSameLocation(cityVar) -> " + kmyQuest.CWs.WindhelmLocation.IsSameLocation(cityVar) as string)

if kmyQuest.CWOFailure == 0
	kmyQuest.CWs.CWOSetGlobal(Alias_Hold.GetLocation(), true)
	if kmyQuest.CWs.GetOwner(Alias_Hold.GetLocation()) != kmyQuest.CWs.Playerallegiance
		kmyQuest.CWs.WinHoldOffScreenIfNotDoingCapitalBattles(Alias_Hold.GetLocation(), true, false)
	elseif kmyQuest.CWOAttack == true && kmyQuest.CWs.GetOwner(Alias_Hold.GetLocation()) == kmyQuest.CWs.Playerallegiance && (kmyQuest.CWs.SolitudeLocation.IsSameLocation(cityVar) || kmyQuest.CWs.WindhelmLocation.IsSameLocation(cityVar))	; Reddit BugFix #18
		kmyQuest.CWs.WinHoldAndSetOwner(Alias_Hold.GetLocation(), true, false)
	endIf
else
	kmyQuest.CWs.CWOSetGlobal(Alias_Hold.GetLocation(), false)
	kmyQuest.CWs.CWODefend(Alias_Hold.GetLocation())
endIf
;kmyquest.CWs.WinHoldAndSetOwner(Alias_Hold.GetLocation(), kmyquest.AttackersHaveWon, kmyquest.DefendersHaveWon)
;CWO Stuff

;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_5
Function Fragment_5()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE

;CWO Stuff
kmyQuest.CWOArmorDisguises.stop()
;schofida - Undo Disguise quest values
kmyQuest.CWs.PlayerFaction.SetEnemy(kmyQuest.CWs.getPlayerAllegianceEnemyFaction(true), false, false)
kmyQuest.CWs.CWODisguiseGlobal.SetValueInt(0)
;CWO Stuff

;Player gets quest from quest giver
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 1 starting")	

;CWO Stuff
kmyQuest.CWs.CWODefendingActive.value = 0 as Float
;CWO Stuff

Alias_WhiterunCompanionsTrigger01.GetReference().Disable(false)
Alias_WhiterunCompanionsTrigger02.GetReference().Disable(false)

;<Toggle Map Markers and Fast Travel>
CWScript.Log("CWSiegeQuestFragmentScript", self + "Toggling map markers and fast travel")

kmyQuest.ToggleMapMarkersAndFastTravelStartBattle(kmyQuest.IsAttack())

;kmyQuest.CWDistantCatapultsAMB.SetValue(1)	;Enable distant catapults if weather is enabled.

;</Toggle Map Markers and Fast Travel>

;<Turn off exterior guards>
CWScript.Log("CWSiegeQuestFragmentScript", self + "Disable exterior patrolling guards")	
;Disable exterior patrolling guards

Alias_GarrisonEnableMarkerImperialExterior.TryToDisable()
Alias_GarrisonEnableMarkerSonsExterior.TryToDisable()
;</Turn off exterior guards>


;<TurnOnAliases>------------------
CWScript.Log("CWSiegeQuestFragmentScript", self + "TurnOnAliases()")		;*** WRITE TO LOG
kmyQuest.TurnOnAliases(kmyQuest.IsAttack())

While kmyquest.DoneTurningOnAliases == false
;do nothing
	utility.wait(1)
	CWScript.Log("CWSiegeQuestFragmentScript", self + "Waiting for DoneTurningOnAliases != false, happens in TurnOnAliases() in CWSiegeScript.psc")	;*** WRITE TO LOG
endWhile

;</TurnOnAliases>------------------

;ENABLE ALLIES
kmyQuest.CWs.CWAlliesS.EnableActiveAllies()
	
;<Setup Camp>
CWScript.Log("CWSiegeQuestFragmentScript", self + "Enabling attacker camp")	
if kmyQuest.CWs.ImperialsAreAttacking(Alias_City.GetLocation())
	Alias_CampEnableMarkerImperial.GetReference().Enable(false)
else
	Alias_CampEnableMarkerSons.GetReference().Enable(false)
endIf

;</Setup Camp>


;<MISC SET UP>----------------
CWScript.Log("CWSiegeQuestFragmentScript", self + "Misc Set up")	;*** WRITE TO LOG


;**** !!! IF YOU PUT SOMETHING HERE, CONSIDER IF IT NEEDS TO BE UNDONE IN THE SHUT DOWN PHASE 255 !!! ****


; CWScript.Log("CWSiegeQuestFragmentScript", self + "Turning on the appropriate advanced soldiers based on player's allegiance")	

;Enable Initial Advanced Defender for correct side
;if kmyQuest.CWs.GetDefender(Alias_City.GetLocation()) == kmyQuest.CWs.iImperials	;Player is an Imperial
;	Alias_NonRespawningDefenderImperial1.TryToEnable()
;	Alias_NonRespawningDefenderImperial2.TryToEnable()
;	Alias_NonRespawningDefenderImperial3.TryToEnable()
;	Alias_NonRespawningDefenderImperial4.TryToEnable()
;	Alias_NonRespawningDefenderImperial5.TryToEnable()
;	Alias_NonRespawningDefenderImperial6.TryToEnable()
;else		;defender is a Sons
;	Alias_NonRespawningDefenderSons1.TryToEnable()
;	Alias_NonRespawningDefenderSons2.TryToEnable()
;	Alias_NonRespawningDefenderSons3.TryToEnable()
;	Alias_NonRespawningDefenderSons4.TryToEnable()
;	Alias_NonRespawningDefenderSons5.TryToEnable()
;	Alias_NonRespawningDefenderSons6.TryToEnable()
;endif

;Enabling the correct reinforcements based on if player is attacking, and which side he's on.
if kmyQuest.CWs.GetAttacker(Alias_City.GetLocation()) == kmyQuest.CWs.iImperials	;Player is an Imperial, and is attacking
	Alias_AttackerImperialReinforceEnabler.GetReference().Enable(false)
elseIf kmyQuest.CWs.GetAttacker(Alias_City.GetLocation()) == kmyQuest.CWs.iSons	;Player is an Sons, and is attacking
	Alias_AttackerSonsReinforceEnabler.GetReference().Enable(false)
endIf

;Enabled the initially disabled center marker so that when it loads its script sets the CW weather as active.  Disabled in 255.
Alias_BattleCenterMarker.GetReference().Enable(false)

if kmyQuest.IsAttack()
	kmyQuest.CWOAttack = true
	((self as Quest) as cwreinforcementcontrollerscript).ShowAttackerPoolObjective = false		;we don't want to show Destroy Attackers XX% Remaining
	((self as Quest) as cwreinforcementcontrollerscript).ShowDefenderPoolObjective = false
else
	((self as Quest) as cwreinforcementcontrollerscript).ShowAttackerPoolObjective = true		;we DO want to show Destroy Attackers XX% Remaining
	;Reddit Bugfix #2
	((self as Quest) as cwreinforcementcontrollerscript).ShowDefenderPoolObjective = true
	;Reddit Bugfix #2
endIf

CWScript.Log("CWSiegeQuestFragmentScript", self + "Calling TryToTurnOnCatapultAlias() on Catapult aliases")	
;Turn on all the Catapults
kmyQuest.TryToTurnOnCatapultAlias(Alias_CatapultAttacker1)
kmyQuest.TryToTurnOnCatapultAlias(Alias_CatapultAttacker2)
kmyQuest.TryToTurnOnCatapultAlias(Alias_CatapultAttacker3)
kmyQuest.TryToTurnOnCatapultAlias(Alias_CatapultAttacker4)

kmyQuest.TryToTurnOnCatapultAlias(Alias_CatapultDefender1)
kmyQuest.TryToTurnOnCatapultAlias(Alias_CatapultDefender2)
kmyQuest.TryToTurnOnCatapultAlias(Alias_CatapultDefender3)
kmyQuest.TryToTurnOnCatapultAlias(Alias_CatapultDefender4)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Blocking activation on gate into city")	
;Prevent player activation of main gate into city
Alias_MainGateExterior.GetReference().BlockActivation(true)

CWScript.Log("CWSiegeQuestFragmentScript", self + "calling ClearGlobals() on Barricade")	
;Set up the globals defining whether the barricade has been broken through yet
(Alias_Barricade1A as cwsiegebarricadescript).ClearGlobals()

;CWO Stuff
Alias_CWOTullius.GetReference().Enable(false)
Alias_CWOUlfric.GetReference().Enable(false)
Alias_CWOBattleRikke.GetReference().Enable(false)
Alias_CWOBattleGalmar.GetReference().Enable(false)
;CWO Stuff

;*** CITY SPECIFIC SCRIPTING IN HERE ***

;**CITY SPECIFIC
;MAKE SURE WHATEVER YOU DO HERE IS MIMIC'D, AND REVERSED, IN 255.
location cityVar = Alias_City.GetLocation()
if cityVar == kmyQuest.CWs.WhiterunLocation

	;PATCH 1.9 -- #73449
	;turn off random dragons
	MQ106TurnOffRandomDragons.SetValue(1)

	Alias_WhiterunBridgeLever1.GetReference().Enable(false)
	(Alias_WhiterunBridgeLever1.GetReference() as WRDrawBridge01SCRIPT).GotoState("ReadyForOpen") ; schofida - Reset state so drawbridge can reopen in the event Imperials try to reclaim Whiterun
	Alias_WhiterunBridgeLever2.GetReference().Enable(false)
	(Alias_WhiterunBridgeLever2.GetReference() as WRDrawBridge01SCRIPT).GotoState("ReadyForOpen") ; schofida - Reset state so drawbridge can reopen in the event Imperials try to reclaim Whiterun
	
	if kmyQuest.IsAttack()
		;If Attack

		;Setting the interior up to look destroyed
		Alias_WhiterunIntEnableOnly.GetReference().Enable(false)
		Alias_WhiterunIntDisableOnly.GetReference().Disable(false)

		CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
		;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(0 as Float)
		kmyQuest.CWAttackerStartingScene.start()
		
		;CWO Stuff
		if kmyQuest.CWs.ImperialsAreAttacking(Alias_City.GetLocation()) && kmyQuest.CWs.Playerallegiance == 1
			if kmyQuest.IsSpecialGeneral == false
				Alias_WhiterunDefenderRikke.GetReference().MoveTo(Alias_AttackerImperial1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerImperial1.GetReference().Disable(false)
				Alias_AttackerImperial1.ForceRefTo(Alias_WhiterunDefenderRikke.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_WhiterunDefenderRikke.GetReference())
				Alias_CWOTullius.GetReference().Disable(false)
				Alias_CWOUlfric.GetReference().Disable(false)
			else
				Alias_CWOTullius.GetReference().MoveTo(Alias_AttackerImperial1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerImperial1.GetReference().Disable(false)
				Alias_AttackerImperial1.ForceRefTo(Alias_CWOTullius.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOTullius.GetReference())
				Alias_WhiterunDefenderRikke.GetReference().MoveTo(Alias_AttackerImperial2.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerImperial2.GetReference().Disable(false)
				Alias_AttackerImperial2.ForceRefTo(Alias_WhiterunDefenderRikke.GetReference())
				Alias_Attacker2.ForceRefTo(Alias_WhiterunDefenderRikke.GetReference())
				Alias_CWOUlfric.GetReference().Disable(false)
			endIf
		elseIf kmyQuest.CWs.SonsAreAttacking(Alias_City.GetLocation()) && kmyQuest.CWs.Playerallegiance == 2
			if kmyQuest.IsSpecialGeneral == false
				Alias_WhiterunAttackerGalmar.GetReference().MoveTo(Alias_AttackerSons1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerSons1.GetReference().Disable(false)
				Alias_AttackerSons1.ForceRefTo(Alias_WhiterunAttackerGalmar.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_WhiterunAttackerGalmar.GetReference())
				Alias_CWOTullius.GetReference().Delete()
				Alias_CWOUlfric.GetReference().Delete()
			else
				Alias_CWOUlfric.GetReference().MoveTo(Alias_AttackerSons1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerSons1.GetReference().Disable(false)
				Alias_AttackerSons1.ForceRefTo(Alias_CWOUlfric.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOUlfric.GetReference())
				Alias_WhiterunAttackerGalmar.GetReference().MoveTo(Alias_AttackerSons2.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerSons2.GetReference().Disable(false)
				Alias_AttackerSons2.ForceRefTo(Alias_WhiterunAttackerGalmar.GetReference())
				Alias_Attacker2.ForceRefTo(Alias_WhiterunAttackerGalmar.GetReference())
				Alias_WhiterunAttackerGalmar.GetActorReference().MoveTo(Alias_CWOUlfric.GetActorReference() as objectreference, 0.000000, 0.000000, 0.000000, true)
				Alias_CWOTullius.GetReference().Delete()
			endIf
		endIf
		;CWO Stuff
		
		Alias_WhiterunSeverioPelagia.GetActorReference().Kill(none)
		Alias_WhiterunSeverioPelagia.GetActorReference().MoveToMyEditorLocation()
	else
		;If defense

		CWScript.Log("CWSiegeQuestFragmentScript", self + "Enabling DisableFastTravelTrigger")
		Alias_DisableFastTravelTrigger.TryToEnable()
		
		CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
		;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(1 as Float)
		kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()
		Alias_ThreatTriggersToggle.TryToEnable()
		
		kmyQuest.CWSiegeDefenderStartingScene.start()
	endIf
	
	;if either attack or defense
	Alias_WhiterunCaravanMarker.GetReference().Disable(false)
	Alias_WhiterunCaravanActor01.GetReference().Disable(false)
	Alias_WhiterunCaravanActor02.GetReference().Disable(false)
	Alias_WhiterunCaravanActor03.GetReference().Disable(false)
	Alias_WhiterunCaravanActor04.GetReference().Disable(false)
	Alias_WhiterunExtEnableOnly.GetReference().Enable(false)
	Alias_WhiterunExtDisableOnly.GetReference().Disable(false)
	Alias_WhiterunDisableNearbyGarrisonEnableMarker1.GetReference().Disable(false)
	Alias_WhiterunDisableNearbyGarrisonEnableMarker2.GetReference().Disable(false)
	Alias_WhiterunDisableNearbyGarrisonEnableMarker3.GetReference().Disable(false)
	Alias_WhiterunDisableNearbyGarrisonEnableMarker4.GetReference().Disable(false)
	Alias_WhiterunDisableNearbyGarrisonEnableMarker5.GetReference().Disable(false)
	Alias_WhiterunDisableNearbyGarrisonEnableMarker6.GetReference().Disable(false)
	Alias_WhiterunDisableNearbyGarrisonEnableMarker7.GetReference().Disable(false)
	Alias_WhiterunDisableNearbyGarrisonEnableMarker8.GetReference().Disable(false)
	(kmyQuest.DA08 as da08questscript).WhiterunSiegeHappening(true)
	
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	if kmyQuest.IsAttack()
						;If Attack
						
						;CWO Stuff
		if kmyQuest.CWs.ImperialsAreAttacking(Alias_City.GetLocation()) && kmyQuest.CWs.Playerallegiance == 1
			if kmyQuest.IsSpecialGeneral == false
				Alias_CWOBattleRikke.GetReference().MoveTo(Alias_AttackerImperial1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerImperial1.GetReference().Disable(false)
				Alias_AttackerImperial1.ForceRefTo(Alias_CWOBattleRikke.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOBattleRikke.GetReference())
				Alias_CWOBattleGalmar.GetReference().Disable(false)
				Alias_CWOTullius.GetReference().Disable(false)
				Alias_CWOUlfric.GetReference().Disable(false)
			else
				Alias_CWOTullius.GetReference().MoveTo(Alias_AttackerImperial1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerImperial1.GetReference().Disable(false)
				Alias_AttackerImperial1.ForceRefTo(Alias_CWOTullius.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOTullius.GetReference())
				Alias_CWOBattleRikke.GetReference().MoveTo(Alias_AttackerImperial2.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerImperial2.GetReference().Disable(false)
				Alias_AttackerImperial2.ForceRefTo(Alias_CWOBattleRikke.GetReference())
				Alias_Attacker2.ForceRefTo(Alias_CWOBattleRikke.GetReference())
				Alias_CWOUlfric.GetReference().Disable(false)
				Alias_CWOBattleGalmar.GetReference().Disable(false)
			endIf
		elseIf kmyQuest.CWs.SonsAreAttacking(Alias_City.GetLocation()) && kmyQuest.CWs.Playerallegiance == 2
			if kmyQuest.IsSpecialGeneral == false
				Alias_CWOBattleGalmar.GetReference().MoveTo(Alias_AttackerSons1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerSons1.GetReference().Disable(false)
				Alias_AttackerSons1.ForceRefTo(Alias_CWOBattleGalmar.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOBattleGalmar.GetReference())
				Alias_CWOBattleRikke.GetReference().Disable(false)
				Alias_CWOTullius.GetReference().Delete()
				Alias_CWOUlfric.GetReference().Delete()
			else
				Alias_CWOUlfric.GetReference().MoveTo(Alias_AttackerSons1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerSons1.GetReference().Disable(false)
				Alias_AttackerSons1.ForceRefTo(Alias_CWOUlfric.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOUlfric.GetReference())
				Alias_CWOBattleGalmar.GetReference().MoveTo(Alias_AttackerSons2.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerSons2.GetReference().Disable(false)
				Alias_AttackerSons2.ForceRefTo(Alias_CWOBattleGalmar.GetReference())
				Alias_Attacker2.ForceRefTo(Alias_CWOBattleGalmar.GetReference())
				Alias_CWOBattleRikke.GetReference().Disable(false)
				Alias_CWOTullius.GetReference().Delete()
			endIf
		endIf
		;CWO Stuff

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
	;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(0 as Float)
		kmyQuest.CWAttackerStartingScene.start()
	else
			;If defense

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
	;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(1 as Float)
		kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()
		Alias_ThreatTriggersToggle.TryToEnable()

	endIf
	
;if either attack or defense
	Alias_MarkarthDisableNearbyGarrisonEnableMarker1.GetReference().Disable(false)
	Alias_MarkarthDisableNearbyGarrisonEnableMarker2.GetReference().Disable(false)
	Alias_MarkarthDisableNearbyGarrisonEnableMarker3.GetReference().Disable(false)
	Alias_MarkarthDisableNearbyGarrisonEnableMarker4.GetReference().Disable(false)
elseIf cityVar == kmyQuest.CWs.RiftenLocation
		;If Attack

	if kmyQuest.IsAttack()
		if kmyQuest.CWs.ImperialsAreAttacking(Alias_City.GetLocation()) && kmyQuest.CWs.Playerallegiance == 1
			if kmyQuest.IsSpecialGeneral == false
				Alias_CWOBattleRikke.GetReference().MoveTo(Alias_AttackerImperial1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerImperial1.GetReference().Disable(false)
				Alias_AttackerImperial1.ForceRefTo(Alias_CWOBattleRikke.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOBattleRikke.GetReference())
				Alias_CWOBattleGalmar.GetReference().Disable(false)
				Alias_CWOTullius.GetReference().Disable(false)
				Alias_CWOUlfric.GetReference().Disable(false)
			else
				Alias_CWOBattleRikke.GetReference().MoveTo(Alias_AttackerImperial2.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerImperial2.GetReference().Disable(false)
				Alias_AttackerImperial2.ForceRefTo(Alias_CWOBattleRikke.GetReference())
				Alias_Attacker2.ForceRefTo(Alias_CWOBattleRikke.GetReference())
				Alias_CWOTullius.GetReference().MoveTo(Alias_AttackerImperial1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerImperial1.GetReference().Disable(false)
				Alias_AttackerImperial1.ForceRefTo(Alias_CWOTullius.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOTullius.GetReference())
				Alias_CWOUlfric.GetReference().Disable(false)
				Alias_CWOBattleGalmar.GetReference().Disable(false)
			endIf
		elseIf kmyQuest.CWs.SonsAreAttacking(Alias_City.GetLocation()) && kmyQuest.CWs.Playerallegiance == 2
			if kmyQuest.IsSpecialGeneral == false
				Alias_CWOBattleGalmar.GetReference().MoveTo(Alias_AttackerSons1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerSons1.GetReference().Disable(false)
				Alias_AttackerSons1.ForceRefTo(Alias_CWOBattleGalmar.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOBattleGalmar.GetReference())
				Alias_CWOBattleRikke.GetReference().Disable(false)
				Alias_CWOTullius.GetReference().Delete()
				Alias_CWOUlfric.GetReference().Delete()
			else
				Alias_CWOUlfric.GetReference().MoveTo(Alias_AttackerSons1.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerSons1.GetReference().Disable(false)
				Alias_AttackerSons1.ForceRefTo(Alias_CWOUlfric.GetReference())
				Alias_Attacker1General.ForceRefTo(Alias_CWOUlfric.GetReference())
				Alias_CWOBattleGalmar.GetReference().MoveTo(Alias_AttackerSons2.GetReference(), 0.000000, 0.000000, 0.000000, true)
				Alias_AttackerSons2.GetReference().Disable(false)
				Alias_AttackerSons2.ForceRefTo(Alias_CWOBattleGalmar.GetReference())
				Alias_Attacker2.ForceRefTo(Alias_CWOBattleGalmar.GetReference())
				Alias_CWOBattleRikke.GetReference().Disable(false)
				Alias_CWOTullius.GetReference().Delete()
			endIf
		endIf

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
	;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(0 as Float)
		kmyQuest.CWAttackerStartingScene.start()
	else
	;If defense

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
	;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(1 as Float)
		kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()
		Alias_ThreatTriggersToggle.TryToEnable()

	endIf
	

;if either attack or defense
	Alias_RiftenDisableNearbyGarrisonEnableMarker1.GetReference().Disable(false)
	Alias_RiftenDisableNearbyGarrisonEnableMarker2.GetReference().Disable(false)
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	if kmyQuest.IsAttack() || kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() == 1
			;If Attack

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
	;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(0 as Float)
		kmyQuest.CWAttackerStartingScene.start()
		
		Alias_Defender1General.GetReference().Disable(false)
		Alias_Defender2.GetReference().Disable(false)
		Alias_Defender3.GetReference().Disable(false)
		Alias_Defender4.GetReference().Disable(false)
		Alias_Defender5.GetReference().Disable(false)
		Alias_Defender6.GetReference().Disable(false)
		Alias_Defender7.GetReference().Disable(false)
		Alias_Defender8.GetReference().Disable(false)
		Alias_Defender9.GetReference().Disable(false)
		Alias_Defender10.GetReference().Disable(false)
		
		;MOVED THIS TO STAGE 1 TO SOLVE BUGS WITH NOT WANTING TO START THIS IF DOING Dark Brotherhood AND WE NEED TO PREVENT THE SIEGE FROM DOING ALL THIS SETUP
		kmyQuest.SolitudeOpening.setStage(200)	;stops the execution scene
		kmyQuest.SetupInteriorSiege(cityVar, Alias_FieldCO.GetReference(), Alias_CityCenterMarker.GetReference())
	else
			;If defense

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
	;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(1 as Float)
		kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()
		Alias_ThreatTriggersToggle.TryToEnable()
	endIf

;if either attack or defense

	Alias_SolitudeDisableNearbyGarrisonEnableMarker1.GetReference().Disable(false)
	Alias_SolitudeDisableNearbyGarrisonEnableMarker2.GetReference().Disable(false)
	Alias_SolitudeCaravanMarker.GetReference().Disable(false)
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	if kmyQuest.IsAttack() || kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() == 1
			;If Attack

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
	;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(0 as Float)
		kmyQuest.CWAttackerStartingScene.start()
					
	;THIS PREVENTS THE MURDER SCENE DURING THE SIEGE
		kmyQuest.MS11.CivilWarBattle(true)

		Alias_Defender1General.GetReference().Disable(false)
		Alias_Defender2.GetReference().Disable(false)
		Alias_Defender3.GetReference().Disable(false)
		Alias_Defender4.GetReference().Disable(false)
		Alias_Defender5.GetReference().Disable(false)
		Alias_Defender6.GetReference().Disable(false)
		Alias_Defender7.GetReference().Disable(false)
		Alias_Defender8.GetReference().Disable(false)
		Alias_Defender9.GetReference().Disable(false)
		Alias_Defender10.GetReference().Disable(false)
		
	;MOVED THIS TO STAGE 1 TO SOLVE BUGS WITH NOT WANTING TO START THIS IF DOING Dark Brotherhood AND WE NEED TO PREVENT THE SIEGE FROM DOING ALL THIS SETUP	
		kmyQuest.SetupInteriorSiege(cityVar, Alias_FieldCO.GetReference(), Alias_CityCenterMarker.GetReference())
	else
			;If defense

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
	;Set BattlePhase
		kmyQuest.CWBattlePhase.SetValue(1 as Float)
		kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()
		Alias_ThreatTriggersToggle.TryToEnable()
	endIf
	
;if either attack or defense

	Alias_WindhelmCaravanMarker.GetReference().Disable(false)
	Alias_WindhelmDockGate.GetReference().SetLockLevel(255)
	Alias_WindhelmDockGate.GetReference().Lock(true, false)
endIf

;CWO Stuff
Alias_Attacker1General.GetReference().Enable(false)
if kmyQuest.CWOAttack == true
	kmyQuest.CWSiegeObjGeneral.ForceRefTo(Alias_Attacker1General.GetReference())
	kmyQuest.ObjAliasTextReplaceAttackDefend.ForceRefTo(kmyQuest.TextReplaceAttack)
else
	kmyQuest.CWSiegeObjGeneral.ForceRefTo(Alias_Defender1General.GetReference())
	kmyQuest.ObjAliasTextReplaceAttackDefend.ForceRefTo(kmyQuest.TextReplaceDefense)
endIf
;CWO Stuff

;<MISC SET UP>----------------

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 1: RegisterForUpdate() and RegisterBattleCenterMarkerAndLocation() so we can check if the player leaves the battle.")
self.RegisterForUpdate(1 as Float)
((kmyQuest as Quest) as cwsiegepollplayerlocation).RegisterBattleCenterMarkerAndLocation(Alias_BattleCenterMarker.GetReference(), Alias_City.GetLocation())

;<CWSiegeObj>------------------
;CWO Stuff
if kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() == 0
	if kmyQuest.IsAttack()
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(1000, 1 as Bool, false);DISPLAYED - Meet with General
	else
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(2000, 1 as Bool, false);DISPLAYED - Meet with General
	endIf
else
	kmyQuest.CWSiegeObj.SetObjectiveDisplayed(500, 1 as Bool, false)
endIf

kmyQuest.CWSiegeObj.setStage(1)
	;CWO Stuff
;</CWSiegeObj>--------------------

;Disable defenders catapults (they were getting enabled somewhere)
Alias_CatapultDefender1.TryToDisable()
Alias_CatapultDefender2.TryToDisable()
Alias_CatapultDefender3.TryToDisable()
Alias_CatapultDefender4.TryToDisable()

;START PREPARE CITY IF DEFENSE
if kmyQuest.IsAttack()
	(Alias_Attacker1General as cwsiegegeneralscript).StartCheckingDistanceToPlayer()
else
	(Alias_Defender1General as cwsiegegeneralscript).StartCheckingDistanceToPlayer()
endIf
if kmyQuest.IsAttack() == false && kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() < 1
	while kmyQuest.CWs.CWPrepareCity.IsRunning() == false
		utility.wait(1 as Float)
		CWScript.Log("CWSiegeQuestFragmentScript", self + "waiting for CWPrepareCity.IsRunning == true")	;*** WRITE TO LOG

	endWhile
	
	CWScript.Log("CWSiegeQuestFragmentScript", self + "Calling setStage(1) on CWPrepareCityStart")	;*** WRITE TO LOG
	kmyQuest.CWs.CWPrepareCity.setStage(1)	;puts everyone in packages
endIf



;10/12 JPD - SOLVES  TTP: 74135
;Moved from Stage 4 in CW quest
kmyQuest.CWs.AddEnemyFortsToBackToWar(false)

;CWO Stuff
if kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() == 1
	kmyQuest.CWs.CWOStillABetterEndingMonitor.start()
endIf
;CWO Stuff



;*** WHITERUN SPECIFIC STUFF ***

;**** **** **** TO DO: DRAW BRIDGE STUFF FROM OLD ATTACK... NEED TO FIX THIS **** **** ****  ****
; ;CWScript.Log("CWSiegeQuestFragmentScript", self + "Set the default state of the drawbridge to UP (isOpen = true)")	
;Set the default state of the drawbridge to UP
;(kmyQuest.DrawBridge as default2StateActivator).IsOpen = TRUE

; ;CWScript.Log("CWSiegeQuestFragmentScript", self + "Disable nearby farm soldiers ")	
;Disable nearby farm soldiers ---Note: we DON'T need to enable these when the quest stops, will be handled by the system that resets the hold after the campaign finishes
;Alias_NearbyFarm01a.GetReference().Disable()  ;Pelagia Imperials
;Alias_NearbyFarm01b.GetReference().Disable()  ;Pelagia Sons

;Alias_WhiterunSonsSoldierToDisable01.GetReference().Disable()
;Alias_WhiterunSonsSoldierToDisable02.GetReference().Disable()
;Alias_WhiterunSonsSoldierToDisable03.GetReference().Disable()
;Alias_WhiterunSonsSoldierToDisable04.GetReference().Disable()


CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 1 done")

;CWO Stuff
if kmyQuest.CWs.CWOSendForPlayer.IsRunning()
	kmyQuest.CWs.CWOSendForPlayer.setStage(20)
endIf
;CWO Stuff

;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_40
Function Fragment_40()
;BEGIN CODE
;Player skipped 40
SetStage(40)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_10
Function Fragment_10()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;DEFENSE ONLY triggered by walking out the main gate
;CWSiege quest stage 7

;Set BattlePhase
kmyQuest.CWBattlePhase.SetValue(0 as Float)
kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()

;Set Global Dialog Stuff
;Attack has started
kmyQuest.CWs.CWStateAttackStarted.SetValue(0 as Float)

;Make sure each of the attacking soldiers start charging right away
Alias_Attacker1General.TryToEvaluatePackage()
Alias_Attacker2.TryToEvaluatePackage()
Alias_Attacker3.TryToEvaluatePackage()
Alias_Attacker4.TryToEvaluatePackage()
Alias_Attacker5.TryToEvaluatePackage()
Alias_Attacker6.TryToEvaluatePackage()
Alias_Attacker7.TryToEvaluatePackage()
Alias_Attacker8.TryToEvaluatePackage()
Alias_Attacker9.TryToEvaluatePackage()
Alias_Attacker10.TryToEvaluatePackage()
Alias_Defender1General.TryToEvaluatePackage()
Alias_Defender2.TryToEvaluatePackage()
Alias_Defender3.TryToEvaluatePackage()
Alias_Defender4.TryToEvaluatePackage()
Alias_Defender5.TryToEvaluatePackage()
Alias_Defender6.TryToEvaluatePackage()
Alias_Defender7.TryToEvaluatePackage()
Alias_Defender8.TryToEvaluatePackage()
Alias_Defender9.TryToEvaluatePackage()
Alias_Defender10.TryToEvaluatePackage()
((kmyQuest as Quest) as cwsiegepollplayerlocation).PlayerHasBeenToLocationOfBattle = true

;**CITY SPECIFIC:
location cityVar = Alias_City.GetLocation()

if cityVar == kmyQuest.CWs.WhiterunLocation
	if kmyQuest.IsAttack()
		;Do Nothing
	else
		;Can't do this because the default starting animation for the bridge is open, so if i tell it to open again it looks broken.
		;Alias_WhiterunDrawbridge.GetReference().PlayGamebryoAnimation("Backward", TRUE)	;Open the drawbridge just as i exit the city.

		;Kill Severio Pelagia since his house is destroyed in whiterun.
		Alias_WhiterunSeverioPelagia.GetActorReference().Kill(none)
		Alias_WhiterunSeverioPelagia.GetActorReference().MoveToMyEditorLocation()
	endIf
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	if kmyQuest.IsAttack()
		;Do Nothing
	;CWO Stuff
	elseif (Alias_MarkarthExteriorGate.GetReference().GetOpenState() == 1  || Alias_MarkarthExteriorGate.GetReference().GetOpenState() == 2)	; Reddit BugFix #15
	;CWO Stuff
		Alias_MarkarthExteriorGate.GetReference().activate(Alias_MarkarthExteriorGate.GetReference(), false) ; Open the gate
		Alias_Defender2.GetReference().MoveTo(Alias_MarkarthMoveDefenderTo1.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Defender3.GetReference().MoveTo(Alias_MarkarthMoveDefenderTo2.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Defender4.GetReference().MoveTo(Alias_MarkarthMoveDefenderTo3.GetReference(), 0.000000, 0.000000, 0.000000, true)
	endIf
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	if kmyQuest.IsAttack()
		;Do Nothing
	else
		Alias_Defender2.GetReference().MoveTo(Alias_RiftenMoveDefenderTo1.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Defender3.GetReference().MoveTo(Alias_RiftenMoveDefenderTo2.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Defender4.GetReference().MoveTo(Alias_RiftenMoveDefenderTo3.GetReference(), 0.000000, 0.000000, 0.000000, true)
	endIf
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	kmyQuest.WeatherSolitude.ForceActive(true)
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	kmyQuest.WeatherWindhelm.ForceActive(true)
endIf
;End Code
endFunction
;End Code

;BEGIN FRAGMENT Fragment_24
Function Fragment_24()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;Defenders have run out of respawns and fallen too low - this is not a victory condition, attackers must still take objectives to win
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 100")	;*** WRITE TO LOG
kmyquest.AttackersHaveWon = TRUE    ;Attackers have won causing defenders to retreat

;kmyquest.CWs.WinHoldAndSetOwnerKeywordDataOnly(Alias_Hold.GetLocation(), kmyquest.AttackersHaveWon, kmyquest.DefendersHaveWon) - CWO Comment out

;Set Dialog States
kmyQuest.CWStateDefenderLastStand.SetValue(1 as Float)
kmyQuest.CWStateDefenderOutOfReinforcements.SetValue(1 as Float)

;THIS ALSO HAPPENS IN STAGE 255 SHUTDOWN
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 100 phase calling TryToTurnOffCatapultAlias() on Catapult aliases")	
;Turn off all the Catapults
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker4)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender4)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_21
Function Fragment_21()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;Fourth Objective is complete -- ATTACKERS HAVE WON
;CWO
if kmyQuest.CWOFailure != 0
	return
endif
;CWO
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50")	;*** WRITE TO LOG

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50, setting CWBattlePhase to 0 IF the player isn't a defender")	;*** WRITE TO LOG
kmyQuest.CWs.CWBattlePhase.SetValue(6 as Float)	;CWO Stuff - TODO: Erroneous?
if kmyQuest.CWOAttack == true
	;Set BattlePhase
	kmyQuest.CWs.CWBattlePhase.SetValue(6 as Float)
	kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()
else
	CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50, Player is an defender, NOT setting CWBattlePhase to 0")	;*** WRITE TO LOG
	kmyQuest.CWOFailure = 1
	if kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() < 0
		kmyQuest.CWs.CWODefendingActive.value = 1 as Float
	endif
endIf

;Unlocking Gate
Alias_MainGateExterior.GetReference().Lock(false, false)

;THIS ALSO HAPPENS IN STAGE 255 SHUTDOWN
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50 phase calling TryToTurnOffCatapultAlias() on Catapult aliases")	
;Turn off all the Catapults
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker4)

kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender4)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50, EVPing everyone")	;*** WRITE TO LOG
;EVP EVERYONE
Alias_Attacker1General.TryToEvaluatePackage()
Alias_Attacker2.TryToEvaluatePackage()
Alias_Attacker3.TryToEvaluatePackage()
Alias_Attacker4.TryToEvaluatePackage()
Alias_Attacker5.TryToEvaluatePackage()
Alias_Attacker6.TryToEvaluatePackage()
Alias_Attacker7.TryToEvaluatePackage()
Alias_Attacker8.TryToEvaluatePackage()
Alias_Attacker9.TryToEvaluatePackage()
Alias_Attacker10.TryToEvaluatePackage()

Alias_Defender1General.TryToEvaluatePackage()
Alias_Defender2.TryToEvaluatePackage()
Alias_Defender3.TryToEvaluatePackage()
Alias_Defender4.TryToEvaluatePackage()
Alias_Defender5.TryToEvaluatePackage()
Alias_Defender6.TryToEvaluatePackage()
Alias_Defender7.TryToEvaluatePackage()
Alias_Defender8.TryToEvaluatePackage()
Alias_Defender9.TryToEvaluatePackage()
Alias_Defender10.TryToEvaluatePackage()


; CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50, setting AttackersHaveWon = True")	;*** WRITE TO LOG

;WE DON'T WANT THIS TO HAPPEN IF THE PLAYER IS DEFENDING ANYMORE, I AM MOVING THIS INTO THE IsAttack() conditioned stuff below
;kmyquest.AttackersHaveWon = True		;Announces the attackers as winner, causing the defenders to retreat

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50, checking Attack/Defense and starting follow up quests")	;*** WRITE TO LOG

;**ATTACK/DEFEND SPECIFIC

kmyQuest.AttackersHaveWon = true
location cityVar = Alias_City.GetLocation()
if kmyQuest.CWOAttack == true
	; 	;CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50, stopping polling player location")	;*** WRITE TO LOG
	;((self as quest) as CWSiegePollPlayerLocation).UnregisterForUpdate()
	kmyQuest.AttackersHaveWon = true
	;if this is the first Whiterun siege (we assume this because the whiterun siege because that is always the first one)
	if kmyQuest.CWs.WhiterunSiegeFinished == false
		kmyQuest.CWs.WhiterunSiegeFinished = true
	endIf

	if ((self as Quest) as cwsiegepollplayerlocation).PlayerHasRunAway == false
		if cityVar != kmyQuest.CWs.SolitudeLocation && cityVar != kmyQuest.CWs.WindhelmLocation
			CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50, starting CWAttackCity quest via story manager script event")	;*** WRITE TO LOG
			kmyQuest.CWs.CWAttackCityStart.SendStoryEvent(Alias_City.GetLocation(), kmyQuest.CWs.GetRikkeOrGalmar(-1) as objectreference, none, 0, 0)
		endIf
	else
		CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50, Calling Stop() and *NOT* starting CWAttackCity because PlayerHasRunAway")	;*** WRITE TO LOG
		kmyQuest.CWSiegeObj.setStage(9000)
		self.stop()
	endIf
	debug.notification("passed the run away check")
else

	;!!!!  *** WE ARE NO LONGER EVER FAILING A DEFENSE MISSION BY THEM PULLING THE LEVER. YOU ONLY EVER FAIL BY WALKING AWAY. THIS MEANS WE DON'T NEED TO DO ANYTHING HERE. *** !!!

	;START ESCORT JARL TO SAFETY QUEST (this also happens in stage 100)

	; 	;CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 50, calling FailDefenseQuest()")	;*** WRITE TO LOG
	;kmyquest.FailDefenseQuest(Alias_City)		;CWSiegeScript

	kmyQuest.CWOFailure = 1
	kmyQuest.FailDefenseQuest(Alias_City)
endIf

;**CITY SPECIFIC:
if cityVar == kmyQuest.CWs.WhiterunLocation
	Alias_WhiterunDrawbridge.GetReference().Enable(false)
	if kmyQuest.CWOAttack == true
		kmyQuest.WhiterunAmbExt01.Disable(false)
		kmyQuest.WhiterunAmbExt02.Disable(false)
		kmyQuest.WhiterunAmbExt03.Enable(false)
	else
			;Set BattlePhase
		kmyQuest.CWs.CWBattlePhase.SetValue(6 as Float)
		kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()
	endIf
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	if kmyQuest.CWOAttack == true
		kmyQuest.CWSiegeObj.SetObjectiveCompleted(1020, 1 as Bool); COMPLETED - open exterior gate
	else
		kmyQuest.CWSiegeObj.SetObjectiveFailed(2060, 1 as Bool); FAILED - open exterior gate
	endIf
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	if kmyQuest.CWOAttack == true
		kmyQuest.CWSiegeObj.SetObjectiveCompleted(1080, 1 as Bool); COMPLETED - final barricade 
	else
		kmyQuest.CWSiegeObj.SetObjectiveFailed(2080, 1 as Bool); FAILED - final barricade
	endIf
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	if kmyQuest.CWOAttack == true
				;kmyquest.CWSiegeObj.SetObjectiveCompleted(1080, 1); COMPLETED - final barricade
	endIf
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	
endIf
if kmyQuest.MQ106.IsCompleted() && !kmyQuest.MQ304.IsCompleted() && cityVar as Bool == (kmyQuest.CWs.WindhelmLocation as Bool || kmyQuest.CWs.SolitudeLocation as Bool)
	Alias_CWOAlduin.GetActorReference().Delete()
	Alias_CWODragon1.GetActorReference().Delete()
	Alias_CWODragon2.GetActorReference().Delete()
endIf
kmyQuest.CWs.CWBattlePhase.SetValue(6 as Float)
;Alias_WhiterunDrawbridge.GetReference().Enable() - CWO Comment out

;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_39
Function Fragment_39()
;BEGIN CODE
;Player skipped 30
SetStage(30)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_18
Function Fragment_18()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;Third Objective is complete

;**ATTACK/DEFEND SPECIFIC
if kmyQuest.IsAttack()
	
endIf

;**CITY SPECIFIC:
location cityVar = Alias_City.GetLocation()
if cityVar == kmyQuest.CWs.WhiterunLocation
	if kmyQuest.CWOFailure as Bool == false ;CWO
		if kmyQuest.IsAttack()
			kmyQuest.CWSiegeObj.SetObjectiveCompleted(1030, 1 as Bool); COMPLETED - Drawbridge
			self.setStage(50)	; whiterun doesn't have a phase 5, so skip ahead.

			;Set Dialog States
			kmyQuest.CWStateAttackerAtGate.SetValue(1 as Float)
			kmyQuest.CWStateAttackStarted.SetValue(0 as Float)
			kmyQuest.CWStateDefenderFallingBack.SetValue(1 as Float)
			kmyQuest.CWStateDefenderLastStand.SetValue(1 as Float)
		else
			kmyQuest.CWSiegeObj.SetObjectiveFailed(2040, 1 as Bool); FAIL - Drawbridge
			self.setStage(50)	; whiterun doesn't have a phase 5, so skip ahead.
		endIf
	endIf ;CWO
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	if kmyquest.IsAttack()
		;no new objectives

	else
		;no new objectives

	endif
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	if kmyQuest.IsAttack()
		kmyQuest.CWSiegeObj.SetObjectiveCompleted(1015, 1 as Bool); COMPLETED - follow general
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(1080, 1 as Bool, false); DISPLAY - final barricade
		
		;Set Dialog States
		kmyQuest.CWStateAttackerAtGate.SetValue(1 as Float)
		kmyQuest.CWStateAttackerBrokeThrough.SetValue(1 as Float)
		kmyQuest.CWStateDefenderLastStand.SetValue(1 as Float)
	else
		;no new objectives, already displayed the defend finale barricade
	endIf
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	if kmyQuest.IsAttack()
		;kmyquest.CWSiegeObj.SetObjectiveCompleted(1080, 1); COMPLETED - barricade
		self.setStage(50)	; windhelm doesn't have a phase 5, so skip ahead.

		;Set Dialog States
		kmyQuest.CWStateAttackerBrokeThrough.SetValue(1 as Float)
	else
		;Currently no defense planned
	endIf
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	if kmyQuest.IsAttack()
		if self.GetStageDone(41)
			Alias_WindhelmGateLever2a.GetReference().activate(Alias_WindhelmGateLever2a.GetReference(), false)
		else
			;Do nothing since the player didn't hit the skip trigger.
		endIf
		kmyQuest.CWSiegeObj.SetObjectiveCompleted(3030, 1 as Bool); COMPLETED - Last Gate
		setStage(50)	; windhelm doesn't have a phase 5, so skip ahead.

		;Set Dialog States
		kmyQuest.CWStateAttackerAtGate.SetValue(1 as Float)
		kmyQuest.CWStateAttackerBrokeThrough.SetValue(1 as Float)
	Else
		; currently no defense planned
	endIf
endIf

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 40")	;*** WRITE TO LOG

;Set BattlePhase
kmyQuest.CWs.CWBattlePhase.SetValue(5 as Float)
kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()

;Reset Dialog States
kmyQuest.CWStateAttackerAtGate.SetValue(0 as Float)
kmyQuest.CWStateAttackerBrokeThrough.SetValue(0 as Float)
kmyQuest.CWStateAttackerLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackerOutOfReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackStarted.SetValue(0 as Float)
kmyQuest.CWStateDefenderFallingBack.SetValue(0 as Float)
kmyQuest.CWStateDefenderLastStand.SetValue(0 as Float)
kmyQuest.CWStateDefenderLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateDefenderOutOfReinforcements.SetValue(0 as Float)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Registers new spawn points: RegisterSpawnAttackerAliases() & RegisterSpawnDefenderAliases()")	;*** WRITE TO LOG
cwreinforcementcontrollerscript CWReinforcementControllerS = (self as Quest) as cwreinforcementcontrollerscript
;Registers initial spawn points
CWReinforcementControllerS.RegisterSpawnAttackerAliases(Alias_RespawnAttackerPhase5A, Alias_RespawnAttackerPhase5B, Alias_RespawnAttackerPhase5C, Alias_RespawnAttackerPhase5D, Alias_RespawnAttackerPhase5FailSafe)
CWReinforcementControllerS.RegisterSpawnDefenderAliases(Alias_RespawnDefenderPhase5A, Alias_RespawnDefenderPhase5B, Alias_RespawnDefenderPhase5C, Alias_RespawnDefenderPhase5D, Alias_RespawnDefenderPhase5FailSafe)


;EVP EVERYONE
Alias_Attacker1General.TryToEvaluatePackage()
Alias_Attacker2.TryToEvaluatePackage()
Alias_Attacker3.TryToEvaluatePackage()
Alias_Attacker4.TryToEvaluatePackage()
Alias_Attacker5.TryToEvaluatePackage()
Alias_Attacker6.TryToEvaluatePackage()
Alias_Attacker7.TryToEvaluatePackage()
Alias_Attacker8.TryToEvaluatePackage()
Alias_Attacker9.TryToEvaluatePackage()
Alias_Attacker10.TryToEvaluatePackage()

Alias_Defender1General.TryToEvaluatePackage()
Alias_Defender2.TryToEvaluatePackage()
Alias_Defender3.TryToEvaluatePackage()
Alias_Defender4.TryToEvaluatePackage()
Alias_Defender5.TryToEvaluatePackage()
Alias_Defender6.TryToEvaluatePackage()
Alias_Defender7.TryToEvaluatePackage()
Alias_Defender8.TryToEvaluatePackage()
Alias_Defender9.TryToEvaluatePackage()
Alias_Defender10.TryToEvaluatePackage()
Alias_WhiterunDrawbridge.GetReference().Enable(false)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_37
Function Fragment_37()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;Gets called at the end of CWAttackerStartingScene, sets Phase 1, then sets stage 10.
CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting initial CWBattlePhase")	
;Set BattlePhase
kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()
Alias_ThreatTriggersToggle.TryToEnable()

kmyQuest.CWAttackerStartingScene.stop()
;CWO
kmyQuest.CWSiegeGeneralChargeScene.start()
if kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() == 0
	kmyQuest.CWSiegeObj.SetObjectiveCompleted(1000, 1 as Bool); COMPLETED - Meet with General
endIf
;CWO
kmyQuest.MUSCombatCivilWar.Add()

;EVP Everyone
Alias_Attacker1General.TryToEvaluatePackage()
Alias_Attacker2.TryToEvaluatePackage()
Alias_Attacker3.TryToEvaluatePackage()
Alias_Attacker4.TryToEvaluatePackage()
Alias_Attacker5.TryToEvaluatePackage()
Alias_Attacker6.TryToEvaluatePackage()
Alias_Attacker7.TryToEvaluatePackage()
Alias_Attacker8.TryToEvaluatePackage()
Alias_Attacker9.TryToEvaluatePackage()
Alias_Attacker10.TryToEvaluatePackage()

Alias_Defender1General.TryToEvaluatePackage()
Alias_Defender2.TryToEvaluatePackage()
Alias_Defender3.TryToEvaluatePackage()
Alias_Defender4.TryToEvaluatePackage()
Alias_Defender5.TryToEvaluatePackage()
Alias_Defender6.TryToEvaluatePackage()
Alias_Defender7.TryToEvaluatePackage()
Alias_Defender8.TryToEvaluatePackage()
Alias_Defender9.TryToEvaluatePackage()
Alias_Defender10.TryToEvaluatePackage()


;**ATTACK/DEFEND SPECIFIC
if kmyQuest.IsAttack()
	kmyQuest.CWOAttack = true
endIf

;**CITY SPECIFIC:
location cityVar = Alias_City.GetLocation()
if cityVar == kmyQuest.CWs.WhiterunLocation
	;kmyQuest.WeatherWhiterun.SetActive(True) - CWO Comment Out
	kmyQuest.CWBattlePhase.SetValue(1 as Float)
	if kmyQuest.IsAttack()
		kmyQuest.WhiterunAmbExt01.Enable(false)
		kmyQuest.AMBDistantBattleSoundInstance = kmyQuest.AMBCivilWarBattleDistantLP.Play(game.GetPlayer() as objectreference)
		kmyQuest.AMBDistantBattleStartInstance = kmyQuest.AMBCivilWarBattleStartDistant.Play(game.GetPlayer() as objectreference)
		kmyQuest.AMBCloseBattleSoundInstance = kmyQuest.AMBCivilWarBattleStart.Play(game.GetPlayer() as objectreference)
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(1005, 1 as Bool, false); DISPLAYED - barricade
		utility.wait(11 as Float)
		self.setStage(10)
	else
		self.setStage(10)
	endIf
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	;kmyQuest.WeatherMarkarth.SetActive(True) - CWO Comment out
	;CWO
	kmyQuest.CWBattlePhase.SetValue(1 as Float)
	;CWO
	if kmyQuest.IsAttack()
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(1005, 1 as Bool, false); DISPLAYED - barricade
		utility.wait(8 as Float)
		self.setStage(10)
	else
		;CWO
		self.setStage(10)
		;CWO
	endIf
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	;kmyQuest.WeatherRiften.SetActive(True) - CWO Comment Out
	;CWO
	kmyQuest.CWBattlePhase.SetValue(1 as Float)
	;CWO
	if kmyQuest.IsAttack()
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(1060, 1 as Bool, false); DISPLAYED - barricade
		self.setStage(10)
	else
		;CWO
		self.setStage(10)
		;CWO
	endIf
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	kmyQuest.WeatherSolitude.SetActive(true, false)
	if kmyQuest.IsAttack()
		;kmyquest.CWSiegeObj.SetObjectiveDisplayed(1060, 1); DISPLAYED - barricade
		;CWO
		if kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() <= 0
			kmyQuest.CWSiegeObj.SetObjectiveCompleted(1000, 1 as Bool); COMPLETED - Meet with General
		endIf
		;CWO
		kmyQuest.CWAttackerStartingScene.stop()
		self.setStage(50)
	else
		;Currently no defense planned	
	endIf
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	kmyQuest.WeatherWindhelm.SetActive(true, false)
	if kmyQuest.IsAttack()
		;kmyquest.CWSiegeObj.SetObjectiveDisplayed(3010, 1); DISPLAYED - barricade
		;CWO
		if kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() <= 0
			kmyQuest.CWSiegeObj.SetObjectiveCompleted(1000, 1 as Bool)
		endIf
		;CWO
		kmyQuest.CWAttackerStartingScene.stop()
		self.setStage(50)
	else
		;Currently no defense planned
	endIf
endIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_38
Function Fragment_38()
;BEGIN CODE
;Make sure that all reinforcements are disabled
(Alias_AttackerImperialReinforceEnabler.GetReference()).Disable()
(Alias_AttackerSonsReinforceEnabler.GetReference()).Disable()
;END CODE
EndFunction
;END FRAGMENT
;BEGIN FRAGMENT Fragment_17
Function Fragment_17()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;Second Objective is complete

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 30")	;*** WRITE TO LOG

;Set BattlePhase
kmyQuest.CWs.CWBattlePhase.SetValue(4 as Float)
kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()

;Reset Dialog States
kmyQuest.CWStateAttackerAtGate.SetValue(0 as Float)
kmyQuest.CWStateAttackerBrokeThrough.SetValue(0 as Float)
kmyQuest.CWStateAttackerLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackerOutOfReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackStarted.SetValue(0 as Float)
kmyQuest.CWStateDefenderFallingBack.SetValue(0 as Float)
kmyQuest.CWStateDefenderLastStand.SetValue(0 as Float)
kmyQuest.CWStateDefenderLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateDefenderOutOfReinforcements.SetValue(0 as Float)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Registers new spawn points: RegisterSpawnAttackerAliases() & RegisterSpawnDefenderAliases()")	;*** WRITE TO LOG
CWReinforcementControllerScript CWReinforcementControllerS = (self as quest ) as CWReinforcementControllerScript

;Registers initial spawn points
CWReinforcementControllerS.RegisterSpawnAttackerAliases(Alias_RespawnAttackerPhase4A, Alias_RespawnAttackerPhase4B, Alias_RespawnAttackerPhase4C, Alias_RespawnAttackerPhase4D, Alias_RespawnAttackerPhase4FailSafe)
CWReinforcementControllerS.RegisterSpawnDefenderAliases(Alias_RespawnDefenderPhase4A, Alias_RespawnDefenderPhase4B, Alias_RespawnDefenderPhase4C, Alias_RespawnDefenderPhase4D, Alias_RespawnDefenderPhase4FailSafe)

;EVP EVERYONE
Alias_Attacker1General.TryToEvaluatePackage()
Alias_Attacker2.TryToEvaluatePackage()
Alias_Attacker3.TryToEvaluatePackage()
Alias_Attacker4.TryToEvaluatePackage()
Alias_Attacker5.TryToEvaluatePackage()
Alias_Attacker6.TryToEvaluatePackage()
Alias_Attacker7.TryToEvaluatePackage()
Alias_Attacker8.TryToEvaluatePackage()
Alias_Attacker9.TryToEvaluatePackage()
Alias_Attacker10.TryToEvaluatePackage()

Alias_Defender1General.TryToEvaluatePackage()
Alias_Defender2.TryToEvaluatePackage()
Alias_Defender3.TryToEvaluatePackage()
Alias_Defender4.TryToEvaluatePackage()
Alias_Defender5.TryToEvaluatePackage()
Alias_Defender6.TryToEvaluatePackage()
Alias_Defender7.TryToEvaluatePackage()
Alias_Defender8.TryToEvaluatePackage()
Alias_Defender9.TryToEvaluatePackage()
Alias_Defender10.TryToEvaluatePackage()

;**ATTACK/DEFEND SPECIFIC
if kmyQuest.IsAttack()
	
endIf

;**CITY SPECIFIC:
location cityVar = Alias_City.GetLocation()
if cityVar == kmyQuest.CWs.WhiterunLocation
	if kmyQuest.IsAttack()		
		;kmyquest.CWSiegeObj.SetObjectiveCompleted(1015, 1); COMPLETED - Follow General
		;kmyquest.CWSiegeObj.SetObjectiveDisplayed(1030, 1); DISPLAY - Drawbridge

		;Set Dialog States
		kmyQuest.CWStateAttackerAtGate.SetValue(1 as Float)
	else
		;fighting with general - we already have the defend drawbridge objective from stage 20
	endIf
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	if kmyQuest.IsAttack()
		kmyquest.CWSiegeObj.SetObjectiveCompleted(1015, 1); COMPLETED - Follow General
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(1020, 1); DISPLAY - Exterior gate
		;Set Dialog States
		kmyQuest.CWStateAttackerAtGate.SetValue(1 as Float)
		kmyQuest.CWStateDefenderLastStand.SetValue(1 as Float)
	else
		;fighting with general - we already have the defend exterior gate
	endIf
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	if kmyQuest.IsAttack()
		;If this stage is set, and these barricades aren't destroyed, then the player has skipped ahead
		;if (Alias_Barricade2A.GetReference().GetCurrentDestructionStage() < 4) && (Alias_Barricade2B.GetReference().GetCurrentDestructionStage() < 4) - CWO Comment out
		Alias_Barricade2A.GetReference().DamageObject(1000 as Float)
		Alias_Barricade2A.GetReference().PlaceAtMe(kmyQuest.CWCatapultExp as form, 1, false, false)
		;endif - CWO Comment out
		
		;Set Dialog States
		kmyQuest.CWStateAttackerBrokeThrough.SetValue(1 as Float)
		kmyQuest.CWStateDefenderFallingBack.SetValue(1 as Float)

		kmyquest.CWSiegeObj.SetObjectiveCompleted(1070, 1); COMPLETED - barricade
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(1015, 1); DISPLAY - follow general
		;CWO
		Alias_Attacker1General.GetReference().MoveTo(Alias_Barricade2A.GetReference(), 0.000000, 0.000000, 0.000000, true)
		;CWO
		(Alias_Attacker1General as cwsiegegeneralscript).FightForAwhile(15, 40)
		;CWO
		self.setStage(40)
		;CWO
	else
		kmyquest.CWSiegeObj.SetObjectiveFailed(2070, 1); FAILED - barricade
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(2080, 1); DISPLAY - barricade
		(Alias_Attacker1General as CWSiegeGeneralScript).FightForAwhile(15, 40)
	endIf
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	if kmyquest.IsAttack()
		if GetStageDone(31)
			Alias_SolitudeGateLever1.GetReference().Activate(Alias_SolitudeGateLever1.GetReference())
		else
			;Do nothing since the player didn't hit the skip trigger.
		endif
		;kmyquest.CWSiegeObj.SetObjectiveCompleted(1020, 1); COMPLETED - barricade
		;kmyquest.CWSiegeObj.SetObjectiveDisplayed(1080, 1); DISPLAY - barricade

		;Set Dialog States
		kmyquest.CWStateAttackerAtGate.SetValue(1)
		kmyquest.CWStateDefenderLastStand.SetValue(1)

	else
		;Currently no defense planned

	endif
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	if kmyquest.IsAttack()
		if GetStageDone(31)
			Alias_WindhelmGateLever1.GetReference().Activate(Alias_WindhelmGateLever1.GetReference())
		else
			;Do nothing since the player didn't hit the skip trigger.
		endif
		kmyquest.CWSiegeObj.SetObjectiveCompleted(3020, 1); COMPLETED - First Gate
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(3030, 1); DISPLAYED - Last Gate

		;Set Dialog States
		kmyquest.CWStateAttackerAtGate.SetValue(1)
		kmyquest.CWStateDefenderLastStand.SetValue(1)

	else
		;Currently no defense planned

	endif
endIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_0
Function Fragment_0()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;<Aliases> --- Register and process aliases with functions declared in CWSiegeScript.psc

;CWO
Alias_DisableFastTravelTrigger.TryToDisable()
kmyQuest.CWOLeaderRandomizer = utility.randomint(0, 100)
if kmyQuest.CWOLeaderRandomizer < 50
	kmyQuest.IsSpecialGeneral = true
endIf
if kmyQuest.CWs.Playerallegiance == 1
	Alias_ImpRikke.GetActorReference().RemoveFromFaction(kmyQuest.CWSoldierPlayerEnemyFaction)
	Alias_ImpRikke.GetActorReference().StopCombat()
endIf
;CWO

CWScript.Log("CWSiegeQuestFragmentScript", self + "setting WasThisAnAttack")  ;*** WRITE TO LOG
kmyQuest.WasThisAnAttack = kmyQuest.IsAttack()

CWScript.Log("CWSiegeQuestFragmentScript", self + "setting CWSiegeRunning keyword data to 1")  ;*** WRITE TO LOG
Alias_City.GetLocation().setKeywordData(kmyQuest.CWs.CWSiegeRunning, 1 as Float)

CWScript.Log("CWSiegeQuestFragmentScript", self + "turning off complex WI interactions")  ;*** WRITE TO LOG
kmyQuest.ToggleOffComplexWIInteractions(Alias_City)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Register and process aliases with functions declared in CWSiegeScript")  ;*** WRITE TO LOG

CWScript.Log("CWSiegeQuestFragmentScript", self + "Register and process Imperial Aliases")	;*** WRITE TO LOG
;Imperial Aliases pointing to references in world:
kmyQuest.RegisterImperialAttackerAliases(Alias_AttackerImperial1, Alias_AttackerImperial2, Alias_AttackerImperial3, Alias_AttackerImperial4, Alias_AttackerImperial5, Alias_AttackerImperial6, Alias_AttackerImperial7, Alias_AttackerImperial8, Alias_AttackerImperial9, Alias_AttackerImperial10)
kmyQuest.RegisterImperialDefenderAliases(Alias_DefenderImperial1, Alias_DefenderImperial2, Alias_DefenderImperial3, Alias_DefenderImperial4, Alias_DefenderImperial5, Alias_DefenderImperial6, Alias_DefenderImperial7, Alias_DefenderImperial8, Alias_DefenderImperial9, Alias_DefenderImperial10)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Register and process Sons Aliases")	;*** WRITE TO LOG
;Sons Aliases pointing to references in world:
kmyQuest.RegisterSonsAttackerAliases(Alias_AttackerSons1, Alias_AttackerSons2, Alias_AttackerSons3, Alias_AttackerSons4, Alias_AttackerSons5, Alias_AttackerSons6, Alias_AttackerSons7, Alias_AttackerSons8, Alias_AttackerSons9, Alias_AttackerSons10)
kmyQuest.RegisterSonsDefenderAliases(Alias_DefenderSons1, Alias_DefenderSons2, Alias_DefenderSons3, Alias_DefenderSons4, Alias_DefenderSons5, Alias_DefenderSons6, Alias_DefenderSons7, Alias_DefenderSons8, Alias_DefenderSons9, Alias_DefenderSons10)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Register and process Attacker/Defender Aliases")	;*** WRITE TO LOG
;Attacker/Defender aliases - which have the packages, etc.
kmyQuest.RegisterAttackerAliases(Alias_Attacker1General, Alias_Attacker2, Alias_Attacker3, Alias_Attacker4, Alias_Attacker5, Alias_Attacker6, Alias_Attacker7, Alias_Attacker8, Alias_Attacker9, Alias_Attacker10)
kmyQuest.RegisterDefenderAliases(Alias_Defender1General, Alias_Defender2, Alias_Defender3, Alias_Defender4, Alias_Defender5, Alias_Defender6, Alias_Defender7, Alias_Defender8, Alias_Defender9, Alias_Defender10)

;*** Currently you can only register 30 things per type... we can change this if we need more. ***
CWScript.Log("CWSiegeQuestFragmentScript", self + "Register and process Generic Aliases")	;*** WRITE TO LOG
;Generic Aliases - things that exist in both the Attack quest and Defend quest 
kmyQuest.RegisterGenericAliases(Alias_enableMarker, Alias_Barricade1A, Alias_Barricade1B, Alias_Barricade2A, Alias_Barricade2B, Alias_Barricade3A, Alias_Barricade3B, Alias_BarricadeGeneric1, Alias_BarricadeGeneric2, Alias_CatapultAttacker1, Alias_CatapultAttacker2, Alias_CatapultAttacker3, Alias_CatapultAttacker4, Alias_CatapultDefender1, Alias_CatapultDefender2, Alias_CatapultDefender3, Alias_CatapultDefender4, none, none, none, none, none, none, none, none, none, none, none, none, none)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Register and process Attack Only Aliases")	;*** WRITE TO LOG
;Attack Aliases - things that exist in only the Attack quest
kmyQuest.RegisterGenericAttackAliases(Alias_AttackTrigger1, Alias_AttackTrigger2, Alias_AttackTrigger3, Alias_AttackTrigger4, Alias_AttackTrigger5, Alias_AttackTrigger6, Alias_AttackArrowVolleyParent1, Alias_AttackArrowVolleyParent2, Alias_AttackArrowVolleyParent3, Alias_AttackArrowVolleyParent4, Alias_AttackArrowVolleyParent5, Alias_AttackArrowVolleyParent6, Alias_AttackArrowVolleyParent7, Alias_AttackArrowVolleyParent8, none, none, none, none, none, none, none, none, none, none, none, none, none, none, none, none)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Register and process Defend Only Aliases")	;*** WRITE TO LOG
;Defend Aliases - things that exist in only the Defend quest
kmyQuest.RegisterGenericDefendAliases(Alias_DefendTrigger1, Alias_DefendTrigger2, Alias_DefendTrigger3, Alias_DefendTrigger4, Alias_DefendArrowVolleyParent1, Alias_DefendArrowVolleyParent2, Alias_DefendArrowVolleyParent3, Alias_DefendArrowVolleyParent4, Alias_DefendArrowVolleyParent5, Alias_DefendArrowVolleyParent6, Alias_DefendArrowVolleyParent7, Alias_DefendArrowVolleyParent8, none, none, none, none, none, none, none, none, none, none, none, none, none, none, none, none, none, none)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Registering Map Markers")	
kmyQuest.RegisterMapMarkerAliases(Alias_AttackerSonsCampMapMarker, Alias_AttackerImperialCampMapMarker, Alias_DisableMapMarkerForBattle1, Alias_DisableMapMarkerForBattle2, Alias_DisableMapMarkerForBattle3, Alias_DisableMapMarkerForBattle4, Alias_DisableMapMarkerForBattle5, Alias_DisableMapMarkerForBattle6, Alias_DisableMapMarkerForBattle7, Alias_DisableMapMarkerForBattle8, Alias_DisableMapMarkerForBattle9, Alias_DisableMapMarkerForBattle10, Alias_DisableMapMarkerForBattle11, Alias_DisableMapMarkerForBattle12, Alias_DisableMapMarkerForBattle13, Alias_DisableMapMarkerForBattle14, Alias_DisableMapMarkerForBattle15, Alias_DisableMapMarkerForBattle16)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Calling SetUpAliases()")	;*** WRITE TO LOG
;Processes all the aliases as needed to start, including disabling, and reseting and enabling the ones that should be turned on
kmyQuest.SetUpAliases(Alias_City.GetLocation())
while kmyQuest.DoneSettingUpAliases == false
	;do nothing
	utility.wait(1)
	CWScript.Log("CWSiegeQuestFragmentScript", self + "Waiting for DoneSettingUpAliases != false, happens in SetUpAliases() in CWSiegeScript.psc")	;*** WRITE TO LOG
endWhile

;</Aliases> ---------------


;<Special Allies> ---------------

CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting up Special Allies.")	;*** WRITE TO LOG

;we are testing for whether player is attacking or defending here so we can simply copy and paste this in all sieges regardless.
if kmyQuest.CWs.PlayersFactionIsAttacker(Alias_City.GetLocation())
	CWScript.Log("CWSiegeQuestFragmentScript", self + "Calling RegisterAllyPhaseMarkers() passing in AllyMarkerAttackerPhaseX markers")	;*** WRITE TO LOG
	kmyQuest.CWs.CWAlliesS.RegisterAllyPhaseMarkers(Alias_AllyMarkerAttack0.GetReference(), Alias_AllyMarkerAttack1.GetReference(), Alias_AllyMarkerAttack2.GetReference(), Alias_AllyMarkerAttack3.GetReference(), Alias_AllyMarkerAttack4.GetReference(), Alias_AllyMarkerAttack5.GetReference(), Alias_AllyMarkerAttack6.GetReference())
elseIf kmyQuest.CWs.PlayersFactionIsDefender(Alias_City.GetLocation())
	CWScript.Log("CWSiegeQuestFragmentScript", self + "Calling RegisterAllyPhaseMarkers() passing in AllyMarkerDefenderPhaseX markers")	;*** WRITE TO LOG
	kmyQuest.CWs.CWAlliesS.RegisterAllyPhaseMarkers(Alias_AllyMarkerDefend0.GetReference(), Alias_AllyMarkerDefend1.GetReference(), Alias_AllyMarkerDefend2.GetReference(), Alias_AllyMarkerDefend3.GetReference(), Alias_AllyMarkerDefend4.GetReference(), Alias_AllyMarkerDefend5.GetReference(), Alias_AllyMarkerDefend6.GetReference())
else  ;something bad happened
	CWScript.Log("CWSiegeQuestFragmentScript", self + " WARNING: Expected player allegiance to be attacking or defending but is neither. THIS WILL BREAK ALLIES SHOWING UP FOR THE BATTLE!")	;*** WRITE TO LOG		
endIf

kmyQuest.CWs.CWAlliesS.ProcessAlliesForSiege(Alias_Hold.GetLocation())


CWScript.Log("CWSiegeQuestFragmentScript", self + "Done Setting up Special Allies.")	;*** WRITE TO LOG

;</Special Allies> ---------------




CWScript.Log("CWSiegeQuestFragmentScript", self + "Calling Reset() on advanced soldiers that aren't meant to respawn")	
;Aiases I will be enabling through the course of the attack.  Should be taken care of in 255.
;CWO
Alias_NonRespawningDefenderImperial1.TryToReset()
Alias_NonRespawningDefenderImperial2.TryToReset()
Alias_NonRespawningDefenderImperial3.TryToReset()
Alias_NonRespawningDefenderImperial4.TryToReset()
Alias_NonRespawningDefenderImperial5.TryToReset()
Alias_NonRespawningDefenderImperial6.TryToReset()

Alias_NonRespawningDefenderSons1.TryToReset()
Alias_NonRespawningDefenderSons2.TryToReset()
Alias_NonRespawningDefenderSons3.TryToReset()
Alias_NonRespawningDefenderSons4.TryToReset()
Alias_NonRespawningDefenderSons5.TryToReset()
Alias_NonRespawningDefenderSons6.TryToReset()

Alias_NonRespawningDefenderImperial1.TryToDisable()
Alias_NonRespawningDefenderImperial2.TryToDisable()
Alias_NonRespawningDefenderImperial3.TryToDisable()
Alias_NonRespawningDefenderImperial4.TryToDisable()
Alias_NonRespawningDefenderImperial5.TryToDisable()
Alias_NonRespawningDefenderImperial6.TryToDisable()

Alias_NonRespawningDefenderSons1.TryToDisable()
Alias_NonRespawningDefenderSons2.TryToDisable()
Alias_NonRespawningDefenderSons3.TryToDisable()
Alias_NonRespawningDefenderSons4.TryToDisable()
Alias_NonRespawningDefenderSons5.TryToDisable()
Alias_NonRespawningDefenderSons6.TryToDisable()

Alias_Barricade1A.TryToReset()
Alias_Barricade1A.GetReference().ClearDestruction() ;Reddit bugfix #15
Alias_Barricade1B.TryToReset()
Alias_Barricade1B.GetReference().ClearDestruction() ;Reddit bugfix #15
Alias_Barricade2A.TryToReset() ;Reddit bugfix #15
Alias_Barricade2A.GetReference().ClearDestruction() ;Reddit bugfix #15
Alias_Barricade2B.TryToReset() ;Reddit bugfix #15
Alias_Barricade2B.GetReference().ClearDestruction() ;Reddit bugfix #15
Alias_Barricade3A.TryToReset() ;Reddit bugfix #15
Alias_Barricade3A.GetReference().ClearDestruction() ;Reddit bugfix #15
Alias_Barricade3B.TryToReset()  ;Reddit bugfix #15
Alias_Barricade3B.GetReference().ClearDestruction() ;Reddit bugfix #15
Alias_BarricadeGeneric1.TryToReset() ;Reddit bugfix #15
Alias_BarricadeGeneric1.GetReference().ClearDestruction() ;Reddit bugfix #15
Alias_BarricadeGeneric2.TryToReset() ;Reddit bugfix #15
Alias_BarricadeGeneric2.GetReference().ClearDestruction() ;Reddit bugfix #15
;CWO

;<Respawn set up>-----------------------

; CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting up Reinforcement Controller Script")	;*** WRITE TO LOG
cwreinforcementcontrollerscript CWReinforcementControllerS = (self as Quest) as cwreinforcementcontrollerscript
;CWO
if kmyQuest.IsAttack()
	kmyQuest.CWs.CWOMurderMayhemScoreBoard(true, 1)
else
	kmyQuest.CWs.CWOMurderMayhemScoreBoard(false, 1)
endIf

CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting Attacker/Defender Pools")	;*** WRITE TO LOG
;Sets starting respawn pool
kmyQuest.SetPoolAttackerOnCWReinforcementScript(kmyQuest.CWs.CWOAttackerReinforcements.GetValueInt(), 1.00000, 1.00000, false)
if kmyQuest.IsAttack()
	kmyQuest.SetPoolDefenderOnCWReinforcementScript(999, 1.00000, 1.00000, false)
else
	kmyQuest.SetPoolDefenderOnCWReinforcementScript(kmyQuest.CWs.CWODefenderReinforcements.GetValueInt(), 1.00000, 1.00000, false)
endIf
;CWO

CWScript.Log("CWSiegeQuestFragmentScript", self + "Calling RegisterAliasesWithCWReinforcementScript()")	;*** WRITE TO LOG
kmyquest.RegisterAliasesWithCWReinforcementScript(Alias_City.GetLocation())	 ;Note: this is the CWSiegeScript.psc calling RegisterAlias on CWReinforcementControllerScript for each attacker and defender alias

CWScript.Log("CWSiegeQuestFragmentScript", self + "Registers initial spawn points: RegisterSpawnAttackerAliases() & RegisterSpawnDefenderAliases()")	;*** WRITE TO LOG
;Registers initial spawn points
CWReinforcementControllerS.RegisterSpawnAttackerAliases(Alias_RespawnAttackerPhase1A, Alias_RespawnAttackerPhase1B, Alias_RespawnAttackerPhase1C, Alias_RespawnAttackerPhase1D, Alias_RespawnAttackerPhase1FailSafe)
CWReinforcementControllerS.RegisterSpawnDefenderAliases(Alias_RespawnDefenderPhase1A, Alias_RespawnDefenderPhase1B, Alias_RespawnDefenderPhase1C, Alias_RespawnDefenderPhase1D, Alias_RespawnDefenderPhase1FailSafe)


;</Respawn set up>-------------------------



;<CWSiegeObj quest setup>------------

CWScript.Log("CWSiegeQuestFragmentScript", self + "Setting up CWSiegeObj quest")	;*** WRITE TO LOG

kmyquest.CWSiegeObj.start()
while kmyQuest.CWSiegeObj.IsRunning() == 0 as Bool
	CWScript.Log("CWSiegeQuestFragmentScript", self + "Waiting for CWSiegeObjquest.IsRunning() != 0")	;*** WRITE TO LOG
	;do nothing
endWhile
	
;NEED TO BREAK THIS OUT FOR ATTACK/DEFEND AND (possibly) SPECIFIC LOCATIONS

CWScript.Log("CWSiegeQuestFragmentScript", self + "Forcing Aliases needed for CWSiegeObj quest")	;*** WRITE TO LOG

kmyQuest.CWSiegeObjCity.ForceLocationTo(Alias_City.GetLocation())
kmyQuest.CWSiegeObjCityGate.ForceRefTo(Alias_MainGateExterior.GetReference())
;CWO
kmyQuest.CWSiegeObjHold.ForceLocationTo(Alias_Hold.GetLocation())
kmyQuest.CWSiegeObjFieldCO.ForceRefTo(kmyQuest.CWs.GetReferenceHQFieldCOForHold(Alias_Hold.GetLocation(), kmyQuest.CWs.Playerallegiance))
;CWO
if kmyQuest.IsAttack()
	;CWO
	kmyQuest.CWOAttack = true
	;CWO
	kmyQuest.CWSiegeObjGeneral.ForceRefTo(Alias_Attacker1General.GetReference())
	kmyQuest.ObjAliasTextReplaceAttackDefend.ForceRefTo(kmyQuest.TextReplaceAttack)
else
	kmyQuest.CWSiegeObjGeneral.ForceRefTo(Alias_Defender1General.GetReference())
	kmyQuest.ObjAliasTextReplaceAttackDefend.ForceRefTo(kmyQuest.TextReplaceDefense)
endIf
	
;kmyquest.CWSiegeObj.setStage(1) - CWO Comment out


;*** CITY SPECIFIC SCRIPTING IN HERE ***

;**CITY SPECIFIC
location cityVar = Alias_City.GetLocation()
if cityVar == kmyQuest.CWs.WhiterunLocation
	kmyQuest.CurrentCity = 4
	kmyquest.CWSiegeObjObjective1A.ForceRefTo(Alias_Objective1A.GetReference())  ;Barricade
	kmyquest.CWSiegeObjObjective2A.ForceRefTo(Alias_Objective2A.GetReference())  ;Bridge lever1
	kmyquest.CWSiegeObjObjective2B.ForceRefTo(Alias_Objective2B.GetReference())   ;Bridge lever2
	if kmyQuest.IsAttack() && kmyQuest.CWs.Playerallegiance == 2
		Alias_AttackerSons1.GetReference().Disable(false)
		Alias_Attacker1General.ForceRefTo(Alias_WhiterunAttackerGalmar.GetReference())
		kmyQuest.CWSiegeObjGeneral.ForceRefTo(Alias_Attacker1General.GetReference())
	elseIf kmyQuest.IsAttack() && kmyQuest.CWs.Playerallegiance == 1
		
	elseIf kmyQuest.CWs.Playerallegiance == 2
		
	elseIf kmyQuest.CWs.Playerallegiance == 1
		Alias_DefenderImperial1.GetReference().Disable(false)
		Alias_Defender1General.ForceRefTo(Alias_WhiterunDefenderRikke.GetReference())
		kmyQuest.CWSiegeObjGeneral.ForceRefTo(Alias_Defender1General.GetReference())
		;kmyquest.CWSiegeObjObjective2A.ForceRefTo(Alias_WhiterunDrawbridgeOBJ.GetReference())  ;Whiterun Drawbridge on defense - CWO Comment out
	endIf
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	kmyquest.CurrentCity = 2
	kmyquest.CWSiegeObjObjective1A.ForceRefTo(Alias_Objective1A.GetReference())  ;Barricade
	kmyquest.CWSiegeObjObjective2A.ForceRefTo(Alias_Objective2A.GetReference())  ;Gate lever1
	kmyquest.CWSiegeObjObjective2B.ForceRefTo(Alias_Objective2B.GetReference())   ;Gate lever2
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	kmyquest.CurrentCity = 9
	kmyquest.CWSiegeObjObjective1A.ForceRefTo(Alias_Objective1A.GetReference())  ;First Barricade
	kmyquest.CWSiegeObjObjective2A.ForceRefTo(Alias_Objective2A.GetReference())  ;Second Barricade
	kmyquest.CWSiegeObjObjective3A.ForceRefTo(Alias_Objective3A.GetReference())  ;Final Barricade A
	kmyquest.CWSiegeObjObjective3B.ForceRefTo(Alias_Objective3B.GetReference())  ;Final Barricade B
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	;MOVED THIS TO STAGE 1 TO SOLVE BUGS WITH NOT WANTING TO START THIS IF DOING Dark Brotherhood AND WE NEED TO PREVENT THE SIEGE FROM DOING ALL THIS SETUP
	;kmyquest.SolitudeOpening.setStage(200)	;stops the execution scene
	;kmyquest.SetupInteriorSiege(cityVar, Alias_FieldCO.GetReference(), Alias_CityCenterMarker.getReference())
	kmyQuest.CurrentCity = 1
	kmyquest.CWSiegeObjObjective1A.ForceRefTo(Alias_Objective1A.GetReference())  ;First Barricade
	kmyquest.CWSiegeObjObjective2A.ForceRefTo(Alias_SolitudeGateLever1.GetReference())  ;Exterior Gate
	kmyquest.CWSiegeObjObjective3A.ForceRefTo(Alias_Objective3A.GetReference())  ;Final Barricade
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	;MOVED THIS TO STAGE 1 TO SOLVE BUGS WITH NOT WANTING TO START THIS IF DOING Dark Brotherhood AND WE NEED TO PREVENT THE SIEGE FROM DOING ALL THIS SETUP	
	;kmyquest.SetupInteriorSiege(cityVar, Alias_FieldCO.GetReference(), Alias_CityCenterMarker.getReference())
	kmyQuest.CurrentCity = 8
	kmyquest.CWSiegeObjObjective1A.ForceRefTo(Alias_Barricade1A.GetReference()) ;First Barricade A
	kmyquest.CWSiegeObjObjective1B.ForceRefTo(Alias_Barricade1B.GetReference()) ;First Barricade B
	kmyquest.CWSiegeObjObjective2A.ForceRefTo(Alias_Objective2A.GetReference()) ;First Gate Lever
	kmyquest.CWSiegeObjObjective3A.ForceRefTo(Alias_Objective3A.GetReference()) ;Second Gate Lever A
	kmyquest.CWSiegeObjObjective3B.ForceRefTo(Alias_Objective3B.GetReference()) ;Second Gate Lever B
endIf

;</CWSiegeObj quest setup>------------



;START PREPARE CITY IF DEFENSE
if kmyquest.IsAttack() == false && kmyQuest.CWs.CWOStillABetterEndingGlobal.GetValueInt() < 1 ;Schofida - Do not start on final losing battle
	CWScript.Log("CWSiegeQuestFragmentScript", self + "Starting CWPrepareCityStart")	;*** WRITE TO LOG
	kmyquest.CWs.CWPrepareCityStart.SendStoryEvent(Alias_City.GetLocation(), none, none, 0, 0)
endif






;*** TEMP SCRIPTING THAT WILL BE REMOVED EVENTUALLY ***
; ;CWScript.Log("CWSiegeQuestFragmentScript", self + "Disabling() test horses and other temp stuff ")	
;TEMP - Enable the Levers and Gates.
;Once we get the final gates this process will be simply closing the already enabled gates
;SecondLever.Enable()
;kmyQuest.TestHorse01a.Disable()
;kmyQuest.TestHorse01b.Disable()
;END CODE
endFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_13
Function Fragment_13()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 10")	;*** WRITE TO LOG

;CWO Stuff
if CWOPrimeMe == True
	return
endif
kmyQuest.CWs.CWOStillABetterEndingMonitor.start()
kmyQuest.CWOWarBegun.setvalueint(1)
;CWO Stuff

;**ATTACK/DEFEND SPECIFIC
if kmyQuest.IsAttack()
	kmyQuest.CWOAttack = true
	kmyQuest.CWSiegeObj.SetObjectiveCompleted(1000, 1 as Bool); COMPLETED - Meet with General
	;kmyquest.CWAttackerStartingScene.Stop()
else
	kmyQuest.CWSiegeObj.SetObjectiveCompleted(2000, 1 as Bool); COMPLETED - Meet with General
endIf

;**CITY SPECIFIC:
location cityVar = Alias_City.GetLocation()

if cityVar == kmyQuest.CWs.WhiterunLocation
;	kmyQuest.WeatherWhiterun.SetActive(True)

	;CWO Stuff
	Alias_WhiterunDrawbridge.GetReference().PlayGamebryoAnimation("Forward", true, 0.000000)
	Alias_WhiterunDrawbridgeNavCollision.GetReference().Enable(false)
	;CWO Stuff
	
	if kmyQuest.IsAttack()
		;kmyquest.CWSiegeObj.SetObjectiveDisplayed(1005, 1); DISPLAYED - barricade
	else
		kmyQuest.AMBDistantBattleSoundInstance = kmyQuest.AMBCivilWarBattleDistantLP.Play(game.GetPlayer() as objectreference)
		kmyQuest.AMBDistantBattleStartInstance = kmyQuest.AMBCivilWarBattleStartDistant.Play(game.GetPlayer() as objectreference)
		;kmyquest.AMBCloseBattleSoundInstance = kmyQuest.AMBCivilWarBattleStart.Play(game.GetPlayer())
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(2030, 1 as Bool, false)
		
		Alias_Attacker1General.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker2.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker3.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker4.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker5.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker6.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker7.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker8.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker9.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker10.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
	endIf
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	if kmyQuest.IsAttack()
		;kmyquest.CWSiegeObj.SetObjectiveDisplayed(1005, 1); DISPLAYED - barricade
	else
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(2030, 1 as Bool, false); DISPLAYED - barricade
		
		Alias_Attacker1General.GetReference().MoveTo(Alias_WhiterunDefenseMoveTo.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker2.GetReference().MoveTo(Alias_RespawnAttackerPhase2FailSafe.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker3.GetReference().MoveTo(Alias_RespawnAttackerPhase2FailSafe.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker4.GetReference().MoveTo(Alias_RespawnAttackerPhase2FailSafe.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker5.GetReference().MoveTo(Alias_RespawnAttackerPhase2FailSafe.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker6.GetReference().MoveTo(Alias_RespawnAttackerPhase2FailSafe.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker7.GetReference().MoveTo(Alias_RespawnAttackerPhase2FailSafe.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker8.GetReference().MoveTo(Alias_RespawnAttackerPhase2FailSafe.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker9.GetReference().MoveTo(Alias_RespawnAttackerPhase2FailSafe.GetReference(), 0.000000, 0.000000, 0.000000, true)
		Alias_Attacker10.GetReference().MoveTo(Alias_RespawnAttackerPhase2FailSafe.GetReference(), 0.000000, 0.000000, 0.000000, true)
	endIf
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	if kmyQuest.IsAttack()
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(1060, 1 as Bool, false); DISPLAYED - barricade
		
		Alias_Barricade3A.GetReference().Enable(false); Enable Barricades that were disabled in 5
		Alias_Barricade2A.GetReference().Enable(false)
	else
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(2065, 1 as Bool, false); DISPLAYED - barricade
	endIf
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	kmyQuest.WeatherSolitude.SetActive(true, false)
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	kmyQuest.WeatherWindhelm.SetActive(true, false)
endIf

;Set BattlePhase
kmyQuest.CWs.CWBattlePhase.SetValue(2 as Float)
kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()

;Reset Dialog States
kmyQuest.CWStateAttackerAtGate.SetValue(0 as Float)
kmyQuest.CWStateAttackerBrokeThrough.SetValue(0 as Float)
kmyQuest.CWStateAttackerLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackerOutOfReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackStarted.SetValue(0 as Float)
kmyQuest.CWStateDefenderFallingBack.SetValue(0 as Float)
kmyQuest.CWStateDefenderLastStand.SetValue(0 as Float)
kmyQuest.CWStateDefenderLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateDefenderOutOfReinforcements.SetValue(0 as Float)

;Set Dialog States
kmyQuest.CWStateAttackStarted.SetValue(1 as Float)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Registers new spawn points: RegisterSpawnAttackerAliases() & RegisterSpawnDefenderAliases()")	;*** WRITE TO LOG
cwreinforcementcontrollerscript CWReinforcementControllerS = (self as Quest) as cwreinforcementcontrollerscript
;Registers initial spawn points
CWReinforcementControllerS.RegisterSpawnAttackerAliases(Alias_RespawnAttackerPhase2A, Alias_RespawnAttackerPhase2B, Alias_RespawnAttackerPhase2C, Alias_RespawnAttackerPhase2D, Alias_RespawnAttackerPhase2FailSafe)
CWReinforcementControllerS.RegisterSpawnDefenderAliases(Alias_RespawnDefenderPhase2A, Alias_RespawnDefenderPhase2B, Alias_RespawnDefenderPhase2C, Alias_RespawnDefenderPhase2D, Alias_RespawnDefenderPhase2FailSafe)

;EVP EVERYONE
Alias_Attacker1General.TryToEvaluatePackage()
Alias_Attacker2.TryToEvaluatePackage()
Alias_Attacker3.TryToEvaluatePackage()
Alias_Attacker4.TryToEvaluatePackage()
Alias_Attacker5.TryToEvaluatePackage()
Alias_Attacker6.TryToEvaluatePackage()
Alias_Attacker7.TryToEvaluatePackage()
Alias_Attacker8.TryToEvaluatePackage()
Alias_Attacker9.TryToEvaluatePackage()
Alias_Attacker10.TryToEvaluatePackage()
Alias_Defender1General.TryToEvaluatePackage()
Alias_Defender2.TryToEvaluatePackage()
Alias_Defender3.TryToEvaluatePackage()
Alias_Defender4.TryToEvaluatePackage()
Alias_Defender5.TryToEvaluatePackage()
Alias_Defender6.TryToEvaluatePackage()
Alias_Defender7.TryToEvaluatePackage()
Alias_Defender8.TryToEvaluatePackage()
Alias_Defender9.TryToEvaluatePackage()
Alias_Defender10.TryToEvaluatePackage()
		
;used for failing if player leaves
((kmyQuest as Quest) as cwsiegepollplayerlocation).PlayerHasBeenToLocationOfBattle = true

;CWO Stuff
CWOPrimeMe = true
;CWO Stuff

;TEMP AMBIENT SOUND TRACK
;kmyquest.StartCombatSoundsLoop()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_11
Function Fragment_11()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;First Objective is complete
kmyQuest.CWs.CWBattlePhase.SetValue(3 as Float)
kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()

;Reset Dialog States
kmyQuest.CWStateAttackerAtGate.SetValue(0 as Float)
kmyQuest.CWStateAttackerBrokeThrough.SetValue(0 as Float)
kmyQuest.CWStateAttackerLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackerOutOfReinforcements.SetValue(0 as Float)
kmyQuest.CWStateAttackStarted.SetValue(0 as Float)
kmyQuest.CWStateDefenderFallingBack.SetValue(0 as Float)
kmyQuest.CWStateDefenderLastStand.SetValue(0 as Float)
kmyQuest.CWStateDefenderLowReinforcements.SetValue(0 as Float)
kmyQuest.CWStateDefenderOutOfReinforcements.SetValue(0 as Float)

CWScript.Log("CWSiegeQuestFragmentScript", self + "Registers new spawn points: RegisterSpawnAttackerAliases() & RegisterSpawnDefenderAliases()")	;*** WRITE TO LOG
cwreinforcementcontrollerscript CWReinforcementControllerS = (self as Quest) as cwreinforcementcontrollerscript
;Registers initial spawn points
CWReinforcementControllerS.RegisterSpawnAttackerAliases(Alias_RespawnAttackerPhase3A, Alias_RespawnAttackerPhase3B, Alias_RespawnAttackerPhase3C, Alias_RespawnAttackerPhase3D, Alias_RespawnAttackerPhase3FailSafe)
CWReinforcementControllerS.RegisterSpawnDefenderAliases(Alias_RespawnDefenderPhase3A, Alias_RespawnDefenderPhase3B, Alias_RespawnDefenderPhase3C, Alias_RespawnDefenderPhase3D, Alias_RespawnDefenderPhase3FailSafe)

;EVP EVERYONE
Alias_Attacker1General.TryToEvaluatePackage()
Alias_Attacker2.TryToEvaluatePackage()
Alias_Attacker3.TryToEvaluatePackage()
Alias_Attacker4.TryToEvaluatePackage()
Alias_Attacker5.TryToEvaluatePackage()
Alias_Attacker6.TryToEvaluatePackage()
Alias_Attacker7.TryToEvaluatePackage()
Alias_Attacker8.TryToEvaluatePackage()
Alias_Attacker9.TryToEvaluatePackage()
Alias_Attacker10.TryToEvaluatePackage()

Alias_Defender1General.TryToEvaluatePackage()
Alias_Defender2.TryToEvaluatePackage()
Alias_Defender3.TryToEvaluatePackage()
Alias_Defender4.TryToEvaluatePackage()
Alias_Defender5.TryToEvaluatePackage()
Alias_Defender6.TryToEvaluatePackage()
Alias_Defender7.TryToEvaluatePackage()
Alias_Defender8.TryToEvaluatePackage()
Alias_Defender9.TryToEvaluatePackage()
Alias_Defender10.TryToEvaluatePackage()

;Make sure that all reinforcements are disabled
Alias_AttackerImperialReinforceEnabler.GetReference().Disable(false)
Alias_AttackerSonsReinforceEnabler.GetReference().Disable(false)

;**ATTACK/DEFEND SPECIFIC
if kmyQuest.IsAttack()
	kmyQuest.CWOAttack = true
endIf

;**CITY SPECIFIC:
location cityVar = Alias_City.GetLocation()

if cityVar == kmyQuest.CWs.WhiterunLocation
	Alias_WhiterunDrawbridge.GetReference().PlayGamebryoAnimation("Forward", true, 0.000000)
	Alias_WhiterunDrawbridgeNavCollision.GetReference().Enable(false)

	;Set Dialog States
	kmyQuest.CWStateAttackerBrokeThrough.SetValue(1 as Float)
	kmyQuest.CWStateDefenderFallingBack.SetValue(1 as Float)
	kmyQuest.CWStateAttackerAtGate.SetValue(1 as Float)
	kmyQuest.CWStateDefenderLastStand.SetValue(1 as Float)
	kmyQuest.CWStateDefenderLowReinforcements.SetValue(1 as Float)
	if kmyQuest.IsAttack()
		;If this stage is set, and these barricades aren't destroyed, then the player has skipped ahead
		if Alias_Barricade1A.GetReference().GetCurrentDestructionStage() < 4 && Alias_Barricade1B.GetReference().GetCurrentDestructionStage() < 4
			Alias_Barricade1A.GetReference().DamageObject(1000 as Float)
			Alias_Barricade1A.GetReference().DamageObject(1000 as Float)
			Alias_Barricade1A.GetReference().PlaceAtMe(kmyQuest.CWCatapultExp as form, 1, false, false)
			kmyQuest.WhiterunAmbExt01.Disable(false)
			kmyQuest.WhiterunAmbExt02.Enable(false)
		endIf
		kmyquest.CWSiegeObj.SetObjectiveCompleted(1005, 1); COMPLETED - barricade
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(1030, 1); DISPLAY - Drawbridge
		;kmyquest.CWSiegeObj.SetObjectiveDisplayed(1015, 1); DISPLAY - Follow General
		(Alias_Attacker1General as cwsiegegeneralscript).FightForAwhile(15, 30)
	else
		kmyquest.CWSiegeObj.SetObjectiveFailed(2030, 1); FAILED - barricade
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(2040, 1); DISPLAY - Drawbridge
		(Alias_Defender1General as cwsiegegeneralscript).FightForAwhile(15, 30)
	endIf
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	;CWO - Moved out of attack block
	;Set Dialog States
	kmyQuest.CWStateAttackerAtGate.SetValue(1 as Float)
	kmyQuest.CWStateAttackerBrokeThrough.SetValue(1 as Float)
	kmyQuest.CWStateDefenderFallingBack.SetValue(1 as Float)
	kmyQuest.CWStateDefenderLastStand.SetValue(1 as Float)
	kmyQuest.CWStateDefenderLowReinforcements.SetValue(1 as Float)
	;CWO
	if kmyQuest.IsAttack()
		;If this stage is set, and these barricades aren't destroyed, then the player has skipped ahead
		;if (Alias_Barricade1A.GetReference().GetCurrentDestructionStage() < 4) && (Alias_Barricade1B.GetReference().GetCurrentDestructionStage() < 4) ;CWO
		Alias_Barricade1A.GetReference().DamageObject(1000 as Float)
		Alias_Barricade1A.GetReference().DamageObject(1000 as Float)
		Alias_Barricade1A.GetReference().PlaceAtMe(kmyQuest.CWCatapultExp as form, 1, false, false)
		;else - CWO Comment Out
		;Set Dialog States
		;kmyquest.CWStateAttackerBrokeThrough.SetValue(1) - CWO Comment Out
		;kmyquest.CWStateDefenderFallingBack.SetValue(1) - CWO Comment Out
		kmyquest.CWSiegeObj.SetObjectiveCompleted(1005, 1); COMPLETED - barricade
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(1015, 1); DISPLAY - Follow General
		;CWO
		Alias_Attacker1General.GetReference().MoveToIfUnloaded(Alias_Barricade1A.GetReference(), 0.000000, 0.000000, 0.000000)
		;CWO
		(Alias_Attacker1General as cwsiegegeneralscript).FightForAwhile(15, 30)
	;else - CWO
	elseif (Alias_MarkarthExteriorGate.GetReference().GetOpenState() == 1  || Alias_MarkarthExteriorGate.GetReference().GetOpenState() == 2)	; Reddit BugFix #15
		kmyquest.CWSiegeObj.SetObjectiveFailed(2030, 1); FAILED - barricade
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(2060, 1); DISPLAY - Exterior gate
		(Alias_Defender1General as CWSiegeGeneralScript).FightForAwhile(15, 30)
		Alias_MarkarthExteriorGate.GetReference().activate(Alias_MarkarthExteriorGate.GetReference()); Close the Gate
	endIf
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	;CWO - Moved out of attack block
	;Set Dialog States
	kmyQuest.CWStateAttackerBrokeThrough.SetValue(1 as Float)
	kmyQuest.CWStateDefenderFallingBack.SetValue(1 as Float)
	;CWO
	if kmyQuest.IsAttack()
		;If this stage is set, and these barricades aren't destroyed, then the player has skipped ahead
		;if (Alias_Barricade1A.GetReference().GetCurrentDestructionStage() < 4) && (Alias_Barricade1B.GetReference().GetCurrentDestructionStage() < 4) - CWO Comment out
		Alias_Barricade1A.GetReference().DamageObject(1000 as Float)
		Alias_Barricade1A.GetReference().DamageObject(1000 as Float)
		Alias_Barricade1A.GetReference().PlaceAtMe(kmyQuest.CWCatapultExp as form, 1, false, false)
		;endif - CWO Comment out
		;kmyQuest.CWStateAttackerBrokeThrough.SetValue(1 as Float) - schofida redundant
		;kmyQuest.CWStateDefenderFallingBack.SetValue(1 as Float) - schofida redundant
		kmyQuest.CWSiegeObj.SetObjectiveCompleted(1060, 1 as Bool)
		kmyQuest.CWSiegeObj.SetObjectiveDisplayed(1070, 1 as Bool, false)
	else
		Alias_Barricade3A.GetReference().Enable(); Enable Barricades that may not have been enabled in 10
		Alias_Barricade2A.GetReference().Enable()

		kmyquest.CWSiegeObj.SetObjectiveFailed(2065, 1); FAILED  - barricade
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(2070, 1); DISPLAY - barricade
	endIf
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	if kmyquest.IsAttack()
		;If this stage is set, and these barricades aren't destroyed, then the player has skipped ahead
		if (Alias_Barricade1A.GetReference().GetCurrentDestructionStage() < 4) && (Alias_Barricade1B.GetReference().GetCurrentDestructionStage() < 4)
			Alias_Barricade1A.GetReference().DamageObject(1000)
			Alias_Barricade1A.GetReference().DamageObject(1000)
			Alias_Barricade1A.GetReference().PlaceAtMe(kmyquest.CWCatapultExp, 1)
		endif

		;Set Dialog States
		kmyquest.CWStateAttackerBrokeThrough.SetValue(1)
		kmyquest.CWStateDefenderFallingBack.SetValue(1)

		;kmyquest.CWSiegeObj.SetObjectiveCompleted(1060, 1); COMPLETED - barricade
		;kmyquest.CWSiegeObj.SetObjectiveDisplayed(1020, 1); DISPLAY - gate

	else
		;Currently no defense planned

	endif
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	if kmyquest.IsAttack()
		;If this stage is set, and these barricades aren't destroyed, then the player has skipped ahead
		if (Alias_Barricade1A.GetReference().GetCurrentDestructionStage() < 4) && (Alias_Barricade1B.GetReference().GetCurrentDestructionStage() < 4)
			Alias_Barricade1A.GetReference().DamageObject(1000)
			Alias_Barricade1A.GetReference().DamageObject(1000)
			Alias_Barricade1A.GetReference().PlaceAtMe(kmyquest.CWCatapultExp, 1)
		endif
		
		;Set Dialog States
		kmyquest.CWStateAttackerBrokeThrough.SetValue(1)
		kmyquest.CWStateDefenderFallingBack.SetValue(1)

		kmyquest.CWSiegeObj.SetObjectiveCompleted(3010, 1); COMPLETED - barricade
		kmyquest.CWSiegeObj.SetObjectiveDisplayed(3020, 1); DISPLAYED - First Gate

	else
		;Currently no defense planned

	endif
endIf
;CWO - Dragon Time!
if kmyQuest.CWOPCChance.GetValueInt() > utility.randomint(0, 100)
	if utility.randomint(0, 100) < 50
		Alias_CWODragon1.GetActorReference().Enable(false)
		Alias_CWODragon1.GetActorReference().StartCombat(game.GetPlayer())
		Alias_CWODragon2.GetActorReference().Delete()
		Alias_CWOAlduin.GetActorReference().Delete()
	else
		Alias_CWODragon1.GetActorReference().Enable(false)
		Alias_CWODragon2.GetActorReference().Enable(false)
		Alias_CWODragon1.GetActorReference().RemoveFromFaction(kmyQuest.DragonFaction)
		Alias_CWODragon2.GetActorReference().StartCombat(Alias_CWODragon1.GetActorReference())
		Alias_CWODragon1.GetActorReference().StartCombat(Alias_CWODragon2.GetActorReference())
		Alias_CWOAlduin.GetActorReference().Delete()
	endIf
else
	Alias_CWODragon1.GetActorReference().Delete()
	Alias_CWODragon2.GetActorReference().Delete()
	Alias_CWOAlduin.GetActorReference().Delete()
endIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_25
Function Fragment_25()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 200")	;*** WRITE TO LOG

;CWO Stuff
if kmyQuest.CWOAttack == true
	kmyQuest.CWs.CWODefendingActive.value = 1 as Float
	kmyQuest.CWOFailure = 1
endIf
;CWO Stuff

;Attackers ran out of respawn tickets and too many died
;-- OLD WAY kmyquest.AttackersHaveWon = False    ;Announces the Defenders as winner, causing the attackers to retreat

kmyquest.DefendersHaveWon = true    ;Announces the Defenders as winner, causing the attackers to retreat

;kmyQuest.CWDistantCatapultsAMB.SetValue(0)	;Disable distant catapults if weather is enabled.
;kmyQuest.WeatherWhiterun.setActive(True)

kmyQuest.CWPrepareCity.setStage(2)
Alias_WhiterunIntEnableOnly.GetReference().Enable(false)
Alias_WhiterunIntDisableOnly.GetReference().Disable(false)
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 200 setting CWBattlePhase to 6");*** WRITE TO LOG
kmyQuest.CWs.CWBattlePhase.SetValue(6 as Float)
kmyQuest.CWs.CWThreatCombatBarksS.RegisterBattlePhaseChanged()

;CWO Stuff
if kmyQuest.CWOFailure == 0
;CWO Stuff
	;Set Dialog States
	kmyQuest.CWStateAttackerOutOfReinforcements.SetValue(1 as Float)
;CWO Stuff
endIf
;CWO Stuff

Alias_Attacker1General.TryToEvaluatePackage()
Alias_Attacker2.TryToEvaluatePackage()
Alias_Attacker3.TryToEvaluatePackage()
Alias_Attacker4.TryToEvaluatePackage()
Alias_Attacker5.TryToEvaluatePackage()
Alias_Attacker6.TryToEvaluatePackage()
Alias_Attacker7.TryToEvaluatePackage()
Alias_Attacker8.TryToEvaluatePackage()
Alias_Attacker9.TryToEvaluatePackage()
Alias_Attacker10.TryToEvaluatePackage()

game.GetPlayer().Addtofaction(kmyQuest.CWs.CWSurrenderTemporaryAllies)

kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker1General)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker2)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker3)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker4)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker5)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker6)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker7)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker8)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker9)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Attacker10)

kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender1General)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender2)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender3)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender4)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender5)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender6)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender7)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender8)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender9)
kmyQuest.CWs.pacifyAliasForSurrender(Alias_Defender10)

;CWO Stuff
if kmyQuest.CWOAttack == false
	if kmyQuest.CWOFailure == 0
		kmyQuest.CWs.WinHoldAndSetOwnerKeywordDataOnly(Alias_Hold.GetLocation(), kmyQuest.AttackersHaveWon, kmyQuest.DefendersHaveWon)
	endIf
endIf
;CWO Stuff

;**CITY SPECIFIC
location cityVar = Alias_City.GetLocation()
if cityVar == kmyQuest.CWs.WhiterunLocation
	;if kmyquest.IsAttack()
	;	;Nothing yet
	;else
		;if this is the first Whiterun siege (we assume this because the whiterun siege because that is always the first one)
		if kmyQuest.CWs.WhiterunSiegeFinished == false
			kmyQuest.CWs.WhiterunSiegeFinished = true
		endIf
		Alias_DisableFastTravelTrigger.TryToDisable()
		if self.GetStageDone(20)
			;Gate was closed in stage 20, so be sure to open it again if the defense wins
			Alias_WhiterunDrawbridge.GetReference().PlayGamebryoAnimation("Backward", true, 0.000000)
			Alias_WhiterunDrawbridgeNavCollision.GetReference().Disable(false)
		endIf
		if kmyQuest.CWs.Playerallegiance == kmyQuest.CWs.iImperials
			if kmyQuest.CWOAttack == false
				if kmyQuest.CWOFailure == 0
				
					;	debug.messageBox("START SPEECH SCENE")
				
					kmyQuest.CWPostWhiterunObj.setStage(1) ;turns on misc objective to Report to Jarl of Whiterun
					Alias_Jarl.GetReference().MoveTo(Alias_SpeechMarker.GetReference(), 0.000000, 0.000000, 0.000000, true)
					Alias_HouseCarl.GetReference().MoveTo(Alias_SpeechMarker.GetReference(), 0.000000, 0.000000, 0.000000, true)
					kmyQuest.CWSiegeWhiterunDefendedScene.start()
				endIf
			endIf
		endIf
	;endif
elseIf cityVar == kmyQuest.CWs.MarkarthLocation
	
elseIf cityVar == kmyQuest.CWs.RiftenLocation
	
elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	
endIf

;THIS ALSO HAPPENS IN STAGE 255 SHUTDOWN
CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 200 phase calling TryToTurnOffCatapultAlias() on Catapult aliases")	
;Turn off all the Catapults
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker4)

kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender4)

if kmyQuest.CWOAttack == true
	;CWO Stuff
	kmyQuest.CWOFailure = 1
	;CWO Stuff
	;NOTE: The following function WAITS in a while loop until the player leaves the city location, so do this LAST
	kmyQuest.FailAttackQuest(Alias_City)		;CWSiegeScript
else ;defenders
	; 	;CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 200, stopping polling player location")	;*** WRITE TO LOG
	;((self as quest) as CWSiegePollPlayerLocation).UnregisterForUpdate()

	;ALSO HAPPENS IN STAGE 255 SHUTDOWN
	kmyQuest.StopCombatSoundsLoop()
	;Removes this music from the stack
	kmyQuest.MUSCombatCivilWar.Remove()
	;CWO Stuff
	if kmyQuest.CWOFailure == 0
		;NOTE: The following function WAITS in a while loop until the player leaves the city location, so do this LAST
		kmyQuest.SucceedDefenseQuest(Alias_Hold, Alias_City, Alias_MainGateExterior)
	endIf
	;CWO Stuff
endIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_22
Function Fragment_22()
;BEGIN AUTOCAST TYPE CWSiegeScript
Quest __temp = self as Quest
CWSiegeScript kmyQuest = __temp as CWSiegeScript
;END AUTOCAST
;BEGIN CODE
;*** this stage is called by the CWSiegeCityDoorScript script

CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 60")	;*** WRITE TO LOG

Alias_WhiterunIntEnableOnly.GetReference().Enable(false)
Alias_WhiterunIntDisableOnly.GetReference().Disable(false)
kmyQuest.WhiterunAmbExt01.Disable(false)
kmyQuest.WhiterunAmbExt02.Disable(false)
kmyQuest.WhiterunAmbExt03.Disable(false)
;kmyQuest.CWDistantCatapultsAMB.SetValue(0)	;Disable distant catapults if weather is enabled.
;kmyQuest.WeatherWhiterun.setActive(True)

; CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 60 calling Stop()")	
;stop()   ;JPD - Not 100% sure this is cool to do here, but I think so. Does anything set stage 100 or 200? If not then its cool, if so, maybe not

;THIS ALSO HAPPENS IN STAGE 255 SHUTDOWN
; CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 60 phase calling TryToTurnOffCatapultAlias() on Catapult aliases")	
;Turn off all the Catapults
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultAttacker4)

kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender1)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender2)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender3)
kmyQuest.TryToTurnOffCatapultAlias(Alias_CatapultDefender4)

;**CITY SPECIFIC
Location cityVar = Alias_City.GetLocation()
if cityVar == kmyQuest.CWs.WhiterunLocation
	if kmyQuest.CWOAttack == true
		Alias_Attacker1General.TryToDisable()
		Alias_Attacker2.TryToDisable()
		Alias_Attacker3.TryToDisable()
		Alias_Attacker4.TryToDisable()
		Alias_Attacker5.TryToDisable()
		Alias_Attacker6.TryToDisable()
		Alias_Attacker7.TryToDisable()
		Alias_Attacker8.TryToDisable()
		Alias_Attacker9.TryToDisable()
		Alias_Attacker10.TryToDisable()
		Alias_Defender1General.TryToDisable()
		Alias_Defender2.TryToDisable()
		Alias_Defender3.TryToDisable()
		Alias_Defender4.TryToDisable()
		Alias_Defender5.TryToDisable()
		Alias_Defender6.TryToDisable()
		Alias_Defender7.TryToDisable()
		Alias_Defender8.TryToDisable()
		Alias_Defender9.TryToDisable()
		Alias_Defender10.TryToDisable()
	endIf
elseIf cityVar == kmyQuest.CWs.MarkarthLocation

elseIf cityVar == kmyQuest.CWs.RiftenLocation

elseIf cityVar == kmyQuest.CWs.SolitudeLocation
	Alias_MainGateInterior.GetReference().Lock(True)
	Alias_MainGateInterior.GetReference().SetLockLevel(255)
	Game.EnableFastTravel(FALSE)
	Alias_DisableFastTravelTrigger.TryToEnable()

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 60, calling CWFinale.SetStage(10)")	;*** WRITE TO LOG
	kmyquest.CWs.CWFinale.SetStage(10)

	;as a safety precaution, disable all the exterior guys
	Alias_Attacker1General.TryToDisable()
	Alias_Attacker2.TryToDisable()
	Alias_Attacker3.TryToDisable()
	Alias_Attacker4.TryToDisable()
	Alias_Attacker5.TryToDisable()
	Alias_Attacker6.TryToDisable()
	Alias_Attacker7.TryToDisable()
	Alias_Attacker8.TryToDisable()
	Alias_Attacker9.TryToDisable()
	Alias_Attacker10.TryToDisable()

	Alias_Defender1General.TryToDisable()
	Alias_Defender2.TryToDisable()
	Alias_Defender3.TryToDisable()
	Alias_Defender4.TryToDisable()
	Alias_Defender5.TryToDisable()
	Alias_Defender6.TryToDisable()
	Alias_Defender7.TryToDisable()
	Alias_Defender8.TryToDisable()
	Alias_Defender9.TryToDisable()
	Alias_Defender10.TryToDisable()
elseIf cityVar == kmyQuest.CWs.WindhelmLocation
	Alias_MainGateInterior.GetReference().Lock(True)
	Alias_MainGateInterior.GetReference().SetLockLevel(255)
	Game.EnableFastTravel(FALSE)
	Alias_DisableFastTravelTrigger.TryToEnable()

	CWScript.Log("CWSiegeQuestFragmentScript", self + "Stage 60, calling CWFinale.SetStage(10)")	;*** WRITE TO LOG
	kmyquest.CWs.CWFinale.SetStage(10)

	;as a safety precaution, disable all the exterior guys
	Alias_Attacker1General.TryToDisable()
	Alias_Attacker2.TryToDisable()
	Alias_Attacker3.TryToDisable()
	Alias_Attacker4.TryToDisable()
	Alias_Attacker5.TryToDisable()
	Alias_Attacker6.TryToDisable()
	Alias_Attacker7.TryToDisable()
	Alias_Attacker8.TryToDisable()
	Alias_Attacker9.TryToDisable()
	Alias_Attacker10.TryToDisable()

	Alias_Defender1General.TryToDisable()
	Alias_Defender2.TryToDisable()
	Alias_Defender3.TryToDisable()
	Alias_Defender4.TryToDisable()
	Alias_Defender5.TryToDisable()
	Alias_Defender6.TryToDisable()
	Alias_Defender7.TryToDisable()
	Alias_Defender8.TryToDisable()
	Alias_Defender9.TryToDisable()
	Alias_Defender10.TryToDisable()
endIf
;END CODE
EndFunction
;END FRAGMENT

;END FRAGMENT CODE - Do not edit anything between this and the begin comment

GlobalVariable Property MQ106TurnOffRandomDragons  Auto  
Quest Property MQ106  Auto  

Quest Property USLEEPHeimskrPreachJail Auto ; USKP 2.0.1 - For sending Heimskr to jail.
ObjectReference Property RiverwoodStormcloaksMarker Auto ; USKP 2.0.4 - Activate Riverwood Stormcloaks if they win Whiterun.
ObjectReference Property RiverwoodImperialsMarker Auto

Bool CWOPrimeMe = false
